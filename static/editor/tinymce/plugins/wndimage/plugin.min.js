tinymce.PluginManager.add("wndimage",function(t,e){let n=t.getParam("wnd_config");var a=function(){async function e(t){let e=axios({url:n.upload_url,method:"POST",data:t}).then(t=>t.data.status<=0?"":t.data[0].data).catch(t=>{console.log(t)});return e}async function a(t){let e=t.name.split(".").pop(),n=await i(e),a=axios({url:n.url,method:"PUT",data:t,headers:n.headers,withCredentials:!1}).then(t=>200==t.status?n:"").catch(t=>{console.log(t)});return a}function i(t){let e=axios({url:n.oss_sign_endpoint,method:"POST",data:{_ajax_nonce:n.oss_sign_nonce,extension:t,data:{post_parent:n.post_parent}}}).then(t=>t.data.data);return e}return t.windowManager.open({title:"",body:{type:"panel",items:[{type:"dropzone",name:"fileinput"},{type:"htmlpanel",html:'<div style="text-align:center;"><img id="wnd-single-img" src=""></div>'},{type:"input",name:"title",label:"Title"}]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Save",primary:!0}],img:{},onSubmit:function(e){let n=e.getData();n.title&&(img.alt=n.title),img.removeAttribute("id"),t.insertContent(img.outerHTML),e.close()},onChange:async function(t,i){if("fileinput"!==i.name)return!1;img=document.querySelector("#wnd-single-img");let o=t.getData(),d=o.fileinput[0];if(n.oss_sign_nonce){let t=await a(d);img.src=t.url,img.dataset.id=t.id}else{let t=new FormData;t.append("wnd_file[]",d),t.append("post_parent",n.post_parent),t.append("_ajax_nonce",n.upload_nonce);let a=await e(t);img.src=a.url,img.dataset.id=a.id}}})};return t.ui.registry.addButton("wndimage",{icon:"image",onAction:function(){a()}}),t.ui.registry.addMenuItem("wndimage",{text:"Wnd Image",onAction:function(){a()}}),{getMetadata:function(){return{name:"Wnd Image",url:"https://wndwp.com"}}}});