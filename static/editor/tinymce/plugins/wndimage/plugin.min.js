tinymce.PluginManager.add("wndimage",function(t,e){let n=t.getParam("wnd_config");var i=function(){async function e(t){let e=axios({url:n.upload_url,method:"POST",data:t}).then(t=>t.data.status<=0?"":t.data[0].data).catch(t=>{console.log(t)});return e}async function i(t){async function e(e){let n=await i(t,e),a=axios({url:n.url,method:"PUT",data:t,headers:n.headers,withCredentials:!1}).then(t=>{if(200!=t.status)return"";img.src=n.url,img.dataset.id=n.id}).catch(t=>{console.log(t)});return a}function i(t,e){let i=t.name.split(".").pop(),a=t.type,o=axios({url:n.oss_sign_endpoint,method:"POST",data:{_ajax_nonce:n.oss_sign_nonce,extension:i,data:{post_parent:n.post_parent},mime_type:a,md5:e}}).then(t=>t.data.data);return o}wnd_load_md5_script(function(){function n(){let e=r*a,n=e+a>=t.size?t.size:e+a;s.readAsArrayBuffer(i.call(t,e,n))}let i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,a=2097152,o=Math.ceil(t.size/a),r=0,l=new SparkMD5.ArrayBuffer,s=new FileReader;s.onload=function(t){if(l.append(t.target.result),r++,r<o)n();else{let t=l.end();e(t)}},s.onerror=function(){console.warn("oops, something went wrong.")},n()})}return t.windowManager.open({title:"",body:{type:"panel",items:[{type:"dropzone",name:"fileinput"},{type:"htmlpanel",html:'<div style="text-align:center;"><img id="wnd-single-img" src="" style="max-width: 100%;"></div>'},{type:"input",name:"title",label:"Title"}]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Insert",primary:!0}],img:{},onSubmit:function(e){let n=e.getData();n.title&&(img.alt=n.title),img.removeAttribute("id"),img.removeAttribute("style"),t.insertContent(img.outerHTML),e.close()},onChange:async function(t,a){if("fileinput"!==a.name)return!1;img=document.querySelector("#wnd-single-img");let o=t.getData(),r=o.fileinput[0];if(n.oss_sign_nonce)i(r);else{let t=new FormData;t.append("wnd_file[]",r),t.append("post_parent",n.post_parent),t.append("_ajax_nonce",n.upload_nonce);let i=await e(t);img.src=i.url,img.dataset.id=i.id}}})};return t.ui.registry.addButton("wndimage",{icon:"image",onAction:function(){i()}}),t.ui.registry.addMenuItem("wndimage",{text:"Wnd Image",onAction:function(){i()}}),{getMetadata:function(){return{name:"Wnd Image",url:"https://wndwp.com"}}}});