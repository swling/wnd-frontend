tinymce.PluginManager.add("wndimage",function(t,e){let n=t.getParam("wnd_config");var i=function(){async function e(t){let e=axios({url:n.upload_url,method:"POST",data:t}).then(t=>t.data.status<=0?(alert(t.data.msg),""):t.data[0].data).catch(t=>{console.log(t)});return e}return t.windowManager.open({title:"",body:{type:"panel",items:[{type:"dropzone",name:"fileinput"},{type:"htmlpanel",html:'<div style="text-align:center;"><img id="wnd-single-img" src="" style="max-width: 100%;"></div>'},{type:"input",name:"title",label:"Title"}]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Insert",primary:!0}],img:{},onSubmit:function(e){let n=e.getData();n.title&&(img.alt=n.title),img.removeAttribute("id"),img.removeAttribute("style"),t.insertContent(img.outerHTML),e.close()},onChange:async function(t,i){if("fileinput"!==i.name)return!1;img=document.querySelector("#wnd-single-img");let a=t.getData(),o=a.fileinput[0];if(n.oss_direct_upload){let t={post_parent:n.post_parent},e=await wnd_upload_to_oss(o,t);e&&(img.src=e.url,img.dataset.id=e.id)}else{let t=new FormData;t.append("wnd_file[]",o),t.append("post_parent",n.post_parent);let i=await e(t);i&&(img.src=i.url,img.dataset.id=i.id)}}})};return t.ui.registry.addButton("wndimage",{icon:"image",onAction:function(){i()}}),t.ui.registry.addMenuItem("wndimage",{text:"Wnd Image",onAction:function(){i()}}),{getMetadata:function(){return{name:"Wnd Image",url:"https://wndwp.com"}}}});