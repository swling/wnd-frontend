tinymce.PluginManager.add("wndimage",function(t,e){let n=t.getParam("wnd_config");var i=function(){async function e(t){let e=axios({url:n.upload_url,method:"POST",data:t}).then(t=>t.data.status<=0?(alert(t.data.msg),""):t.data[0].data).catch(t=>{console.log(t)});return e}async function i(t){async function e(e){let n=await i(t,e);if(n.status<=0)return alert(n.msg),!1;let a=n.data,r=axios({url:a.url,method:"PUT",data:t,headers:a.headers,withCredentials:!1}).then(t=>{img.src=a.url,img.dataset.id=a.id}).catch(t=>{wnd_delete_attachment(a.id)});return r}function i(t,e){let i=t.name.split(".").pop(),a=t.type,r=axios({url:n.oss_sign_endpoint,method:"POST",data:{extension:i,post_parent:n.post_parent,mime_type:a,md5:e}}).then(t=>t.data);return r}wnd_load_md5_script(function(){function n(){let e=o*a,n=e+a>=t.size?t.size:e+a;d.readAsArrayBuffer(i.call(t,e,n))}let i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,a=2097152,r=Math.ceil(t.size/a),o=0,l=new SparkMD5.ArrayBuffer,d=new FileReader;d.onload=function(t){if(l.append(t.target.result),o++,o<r)n();else{let t=l.end();e(t)}},d.onerror=function(){console.warn("oops, something went wrong.")},n()})}return t.windowManager.open({title:"",body:{type:"panel",items:[{type:"dropzone",name:"fileinput"},{type:"htmlpanel",html:'<div style="text-align:center;"><img id="wnd-single-img" src="" style="max-width: 100%;"></div>'},{type:"input",name:"title",label:"Title"}]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Insert",primary:!0}],img:{},onSubmit:function(e){let n=e.getData();n.title&&(img.alt=n.title),img.removeAttribute("id"),img.removeAttribute("style"),t.insertContent(img.outerHTML),e.close()},onChange:async function(t,a){if("fileinput"!==a.name)return!1;img=document.querySelector("#wnd-single-img");let r=t.getData(),o=r.fileinput[0];if(n.oss_direct_upload)i(o);else{let t=new FormData;t.append("wnd_file[]",o),t.append("post_parent",n.post_parent);let i=await e(t);i&&(img.src=i.url,img.dataset.id=i.id)}}})};return t.ui.registry.addButton("wndimage",{icon:"image",onAction:function(){i()}}),t.ui.registry.addMenuItem("wndimage",{text:"Wnd Image",onAction:function(){i()}}),{getMetadata:function(){return{name:"Wnd Image",url:"https://wndwp.com"}}}});