tinymce.PluginManager.add("wndimage",(function(t,e){let n=t.getParam("wnd_config"),i=function(){return t.windowManager.open({title:"",body:{type:"panel",items:[{type:"dropzone",name:"fileinput"},{type:"htmlpanel",html:'<div style="text-align:center;"><img id="wnd-single-img" src="" style="max-width: 100%;"></div>'},{type:"input",name:"title",label:"Title"}]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Insert",primary:!0}],img:{},onSubmit:function(e){let n=e.getData();n.title&&(img.alt=n.title),img.removeAttribute("id"),img.removeAttribute("style"),t.insertContent(img.outerHTML),e.close()},onChange:async function(t,e){if("fileinput"!==e.name)return!1;img=document.querySelector("#wnd-single-img");let i=t.getData().fileinput[0];const{width:a,height:o}=await async function(t){return new Promise(((e,n)=>{const i=new FileReader;i.onload=function(t){const i=new Image;i.onload=function(){e({width:i.width,height:i.height})},i.onerror=n,i.src=t.target.result},i.onerror=n,i.readAsDataURL(t)}))}(i);if(n.oss_direct_upload){let t={post_parent:n.post_parent},e=await wnd_upload_to_oss(i,t);e&&(img.src=e.url,img.dataset.id=e.id,img.width=a,img.height=o,img.loading="lazy")}else{let t=new FormData;t.append("wnd_file",i),t.append("post_parent",n.post_parent);let e=await async function(t){return axios({url:n.upload_url,method:"POST",data:t}).then((t=>t.data.status<=0?(alert(t.data.msg),""):t.data.data)).catch((t=>{}))}(t);e&&(img.src=e.url,img.dataset.id=e.id,img.width=a,img.height=o,img.loading="lazy")}}})};return t.ui.registry.addButton("wndimage",{icon:"image",onAction:function(){i()}}),t.ui.registry.addMenuItem("wndimage",{text:"Wnd Image",onAction:function(){i()}}),{getMetadata:function(){return{name:"Wnd Image",url:"https://wndwp.com"}}}}));