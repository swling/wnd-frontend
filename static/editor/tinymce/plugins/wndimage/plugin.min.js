tinymce.PluginManager.add("wndimage",function(t,e){var n=function(){async function e(t,e){let n=axios({url:e,method:"POST",data:t}).then(t=>t.data.status<=0?"":t.data[0].data).catch(t=>{console.log(t)});return n}async function n(t,e,n){let i=t.name.split(".").pop(),o=await a(i,e,n),d=axios({url:o.url,method:"PUT",data:t,headers:o.headers,withCredentials:!1}).then(t=>200==t.status?o:"").catch(t=>{console.log(t)});return d}function a(t,e,n){let a=axios({url:n,method:"POST",data:{_ajax_nonce:e,extension:t}}).then(t=>t.data.data);return a}return t.windowManager.open({title:"",body:{type:"panel",items:[{type:"dropzone",name:"fileinput"},{type:"htmlpanel",html:'<div style="text-align:center;"><img id="wnd-single-img" src=""></div>'},{type:"input",name:"title",label:"Title"}]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Save",primary:!0}],img:{},onSubmit:function(e){var n=e.getData();n.title&&(img.alt=n.title),img.removeAttribute("id"),t.insertContent(img.outerHTML),e.close()},onChange:async function(a,i){if("fileinput"!==i.name)return!1;img=document.querySelector("#wnd-single-img");let o=t.getParam("wnd_config"),d=a.getData(),r=d.fileinput[0];if(o.oss_sign_nonce){let t=await n(r,o.oss_sign_nonce,o.oss_sign_endpoint);img.src=t.url,img.dataset.id=t.id}else{let t=new FormData;t.append("wnd_file[]",r),t.append("post_parent",o.post_parent),t.append("_ajax_nonce",o.upload_nonce);let n=await e(t,o.upload_url);img.src=n.url,img.dataset.id=n.id}}})};return t.ui.registry.addButton("wndimage",{icon:"image",onAction:function(){n()}}),t.ui.registry.addMenuItem("wndimage",{text:"Wnd Image",onAction:function(){n()}}),{getMetadata:function(){return{name:"Wnd Image",url:"https://wndwp.com"}}}});