tinymce.PluginManager.add("wndimage",function(e,t){var n=function(){return e.windowManager.open({title:"",body:{type:"panel",items:[{type:"dropzone",name:"fileinput"},{type:"htmlpanel",html:'<div style="text-align:center;"><img id="wnd-single-img" src=""></div>'},{type:"input",name:"title",label:"Title"}]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Save",primary:!0}],img:{},onSubmit:function(t){var n=t.getData();n.title&&(img.alt=n.title),img.removeAttribute("id"),e.insertContent(img.outerHTML),t.close()},onChange:function(t,n){if("fileinput"!==n.name)return!1;img=document.querySelector("#wnd-single-img");let a=e.getParam("wnd_config"),i=t.getData(),o=i.fileinput[0],r=new FormData;r.append("wnd_file[]",o),r.append("post_parent",a.post_parent),r.append("_ajax_nonce",a.upload_nonce);let d=new XMLHttpRequest;d.open("POST",a.upload_url),d.setRequestHeader("X-WP-Nonce",a.rest_nonce),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(res=JSON.parse(d.responseText),imgurl=res.data[0].url,img.src=imgurl,img.dataset.id=res.data[0].id)},d.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(t)}},d.send(r)}})};return e.ui.registry.addButton("wndimage",{icon:"image",onAction:function(){n()}}),e.ui.registry.addMenuItem("wndimage",{text:"Wnd Image",onAction:function(){n()}}),{getMetadata:function(){return{name:"Wnd Image",url:"https://wndwp.com"}}}});