var $=jQuery.noConflict();function getCookie(c_name){return document.cookie.length>0&&(c_start=document.cookie.indexOf(c_name+"="),-1!=c_start)&&(c_start=c_start+c_name.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end)))}function setCookie(name,value,seconds,path="/"){if(!(seconds=seconds?1e3*seconds:0))return!1;var expires="",date=new Date;date.setTime(date.getTime()+seconds),expires="; expires="+date.toGMTString(),document.cookie=name+"="+escape(value)+expires+"; path="+path}function isMob(){return!!navigator.userAgent.match(/(iPhone|iPad|iPod|Android|ios|App\/)/i)}function wnd_alert_modal(html){wnd_reset_modal(),$(".modal").addClass("is-active"),$(".modal-content").addClass("box"),$(".modal-entry").html(html)}function wnd_alert_msg(msg){wnd_reset_modal(),$(".modal").addClass("is-active"),$(".modal-content").removeClass("box"),$(".modal-entry").html('<div class="alert-msg" style="color:#FFF;text-align:center">'+msg+"</div>")}function wnd_ajax_msg(msg,color="is-danger",parent="body"){$(parent+" .ajax-msg").html('<div class="message '+color+'"><div class="message-body">'+msg+"</div></div>"),$(".modal").hasClass("is-active")||document.body.scrollIntoView({behavior:"smooth"})}function wnd_reset_modal(){$("#modal").length?($(".modal").removeClass("is-active"),$(".ajax-msg").empty(),$(".modal-entry").empty()):$("body").append('<div id="modal" class="modal"><div class="modal-background"></div><div class="modal-content"><div class="modal-entry"></div></div><button class="modal-close is-large" aria-label="close"></button></div>')}function wnd_click(target_element){$(target_element).trigger("click")}function wnd_confirm_form_submit(form_id,msg=""){wnd_alert_modal("<p>"+msg+'</p><div class="field is-grouped is-grouped-centered"><div class="control"><button class="button is-dark"  onclick="wnd_ajax_submit(\''+form_id+"')\" >确定</button></div></div>")}function wnd_ajax_modal(handle,param=0){wnd_reset_modal(),$.ajax({type:"POST",url:ajaxurl,data:{handle:handle,param:param,action_name:"_wnd_ajax_r",action:"wnd_action"},beforeSend:function(){wnd_alert_msg("……")},success:function(response){"object"==typeof response?wnd_alert_msg(response.msg):wnd_alert_modal(response)},error:function(){wnd_alert_msg("系统错误！")}})}function wnd_ajax_r(container="body",handle,param){$.ajax({type:"POST",url:ajaxurl,data:{handle:handle,param:param,action_name:"_wnd_ajax_r",action:"wnd_action"},beforeSend:function(){wnd_alert_msg("……")},success:function(response){wnd_reset_modal(),"object"==typeof response?wnd_alert_msg(response.msg):$(container).html(response)},error:function(){wnd_alert_msg("系统错误！")}})}function wnd_ajax_submit(form_id){var input_value=!0;if($(form_id+" input").each(function(){var required;if("required"==$(this).attr("required")&&""==$(this).val())return input_value=!1,!1}),!1===input_value)return wnd_ajax_msg('<span class="required">*</span>星标为必填项目！',"is-danger",form_id),!1;var option_value=!0;if($(form_id+" select option:selected").each(function(){var required=$(this).parent().attr("required");if(option_value=$(this).val(),"required"==required&&"-1"==option_value)return option_value=!1,!1}),!1===option_value)return wnd_ajax_msg('<span class="required">*</span>星标为必选项目！',"is-danger",form_id),!1;if($(".wp-editor-area").length>0){var wp_editor_id=$(".wp-editor-area").attr("id"),content,editor=tinyMCE.get(wp_editor_id);content=editor?editor.getContent():$("#"+wp_editor_id).val(),$("#"+wp_editor_id).val(content)}var options={url:ajaxurl,dataType:"json",beforeSubmit:showRequest,success:showResponse,error:showError};function showRequest(formData,jqForm,options){$("[name='submit']").addClass("is-loading"),$("[name='submit']").attr("disabled",!0)}function showResponse(response,statusText,xhr,$form){if($("[name='submit']").removeClass("is-loading"),response.status<=0){var color="is-danger";$("[name='submit']").attr("disabled",!1)}else var color="is-success";switch(response.status){case 1:wnd_ajax_msg(response.msg,color,form_id);break;case 2:wnd_ajax_msg('提交成功！<a href="'+response.msg+'" target="_blank">查看</a>',color,form_id);break;case 3:wnd_ajax_msg("提交成功！",color,form_id),$(location).attr("href",response.msg);break;case 4:location.reload();break;default:wnd_ajax_msg(response.msg,color,form_id)}}function showError(){wnd_ajax_msg("系统错误！","is-danger"),$("[name='submit']").removeClass("is-loading"),$("[name='submit']").attr("disabled",!1)}$(form_id).ajaxSubmit(options)}jQuery(document).ready(function($){$("body").off("click").on("click",".modal-background,.modal-close,.delete",function(){wnd_reset_modal()})}),jQuery(document).ready(function($){if($(".upload-field [type='file']").change(function(){var id="#"+$(this).data("id"),form_data=new FormData,file_data=$(this).prop("files")[0],meta_key=$(id+" [name='file_meta_key']").val(),post_parent=$(id+" [name='file_post_parent']").val(),_ajax_nonce=$(id+" [name='file_upload_nonce']").val(),save_width=$(id+" [name='file_save_width']").val(),save_height=$(id+" [name='file_save_height']").val(),file_type=$(id+" [name='file_type']").val();form_data.append("file",file_data),form_data.append("meta_key",meta_key),form_data.append("post_parent",post_parent),form_data.append("_ajax_nonce",_ajax_nonce),form_data.append("save_width",save_width),form_data.append("save_height",save_height),form_data.append("action","wnd_action"),form_data.append("action_name","wnd_upload_file"),$.ajax({url:ajaxurl,dataType:"json",cache:!1,contentType:!1,processData:!1,data:form_data,type:"post",beforeSend:function(){wnd_ajax_msg("正在处理，请勿关闭页面！","is-warning")},success:function(response){if(0===response.status)return wnd_ajax_msg(response.msg,"is-danger"),!1;wnd_ajax_msg("上传成功！","is-success"),"image"==file_type&&$(id+" .thumb").prop("src",response.msg.url),$(id+" .delete").data("attachment-id",response.msg.id)},error:function(){wnd_ajax_msg("系统错误！")}})}),$(".upload-field").off("click").on("click",".delete",function(){if(!confirm("确定删除？"))return!1;var id="#"+$(this).data("id"),attachment_id=$(this).data("attachment-id");if(!attachment_id)return wnd_ajax_msg("没有可删除的文件！"),!1;var form_data=new FormData,meta_key=$(id+" [name='file_meta_key']").val(),post_parent=$(id+" [name='file_post_parent']").val(),_ajax_nonce=$(id+" [name='file_delete_nonce']").val(),file_type=$(id+" [name='file_type']").val(),default_thumb=$(id+" [name='file_default_thumb']").val();form_data.append("meta_key",meta_key),form_data.append("post_parent",post_parent),form_data.append("attachment_id",attachment_id),form_data.append("_ajax_nonce",_ajax_nonce),form_data.append("action","wnd_action"),form_data.append("action_name","wnd_delete_attachment"),$.ajax({url:ajaxurl,dataType:"json",cache:!1,contentType:!1,processData:!1,data:form_data,type:"post",beforeSend:function(){wnd_ajax_msg("删除中……","is-warning")},success:function(response){if(0===response.status)return wnd_ajax_msg(response.msg,"is-danger"),!1;wnd_ajax_msg("已删除！","is-success"),"image"==file_type&&$(id+" .thumb").prop("src",default_thumb),$(id+" .delete").data("attachment-id",0)},error:function(){wnd_ajax_msg("系统错误！")}})}),$("#new-post").length>0&&$("#new-post input[name='_post_post_id']").length>0){function wnd_edit_ping(){var post_id=$("input[name='_post_post_id']").val();$.ajax({type:"POST",datatype:"json",async:!1,url:ajaxurl,data:{post_id:post_id,action_name:"_wnd_edit_ping",action:"wnd_action"}})}var ping=setInterval(wnd_edit_ping,3e4);$("[name='submit']").off("click").on("click",function(event){window.clearInterval(ping)})}$("form").change(function(){$("[name='submit']").attr("disabled",!1)})});