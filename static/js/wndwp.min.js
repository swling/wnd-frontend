var $=jQuery.noConflict();function getCookie(c_name){return document.cookie.length>0&&(c_start=document.cookie.indexOf(c_name+"="),-1!=c_start)&&(c_start=c_start+c_name.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end)))}function setCookie(name,value,seconds,path="/"){if(!(seconds=seconds?1e3*seconds:0))return!1;var expires="",date=new Date;date.setTime(date.getTime()+seconds),expires="; expires="+date.toGMTString(),document.cookie=name+"="+escape(value)+expires+"; path="+path}function wnd_is_mob(){return!!navigator.userAgent.match(/(iPhone|iPad|iPod|Android|ios|App\/)/i)}function wnd_is_spider(){var userAgent;return!!navigator.userAgent.match(/(Googlebot|Baiduspider|spider)/i)}var wait=90,send_countdown,ajax_alert_time_out,ajax_msg_time_out;function wnd_send_countdown(){wait>0?($(".send-code").text(wait+"秒"),wait--,send_countdown=setTimeout(wnd_send_countdown,1e3)):($(".send-code").text("获取验证码").attr("disabled",!1).fadeTo("slow",1),wait=90)}function wnd_alert_modal(html){wnd_reset_modal(),$(".modal").addClass("is-active"),$(".modal-entry").addClass("box"),$(".modal-entry").html(html)}function wnd_alert_msg(msg,wait=0){wnd_reset_modal(),$(".modal").addClass("is-active"),$(".modal-entry").removeClass("box"),$(".modal-entry").html('<div class="alert-msg" style="color:#FFF;text-align:center">'+msg+"</div>"),wait>0&&(ajax_alert_time_out=setTimeout(function(){wnd_reset_modal()},1e3*wait))}function wnd_ajax_msg(msg,color="is-danger",parent="body",wait=0){var target;($(parent+" .ajax-msg:first").html('<div class="message '+color+'"><div class="message-body">'+msg+"</div></div>"),$(".modal").hasClass("is-active"))||$(parent).get(0).scrollIntoView({behavior:"smooth"});wait>0&&(ajax_msg_time_out=setTimeout(function(){$(parent+" .ajax-msg:first").empty()},1e3*wait))}function wnd_reset_modal(){clearTimeout(ajax_msg_time_out),clearTimeout(ajax_alert_time_out),clearTimeout(send_countdown),$("#modal").length?($(".modal").removeClass("is-active"),$(".ajax-msg").empty(),$(".modal-entry").empty()):$("body").append('<div id="modal" class="modal"><div class="modal-background"></div><div class="modal-content"><div class="modal-entry"></div></div><button class="modal-close is-large" aria-label="close"></button></div>')}function wnd_click(target_element){$(target_element).trigger("click")}function wnd_confirm_form_submit(form_id,msg=""){wnd_alert_modal("<p>"+msg+'</p><div class="field is-grouped is-grouped-centered"><div class="control"><button class="button is-dark"  onclick="wnd_ajax_submit(\''+form_id+"')\" >确定</button></div></div>")}function wnd_ajax_modal(handle,param=0){wnd_reset_modal(),$.ajax({type:"POST",url:ajaxurl,data:{handle:handle,param:param,ajax_type:"modal",action_name:"_wnd_ajax_r",action:"wnd_action"},beforeSend:function(){wnd_alert_msg("……")},success:function(response){"object"==typeof response?wnd_alert_msg(response.msg):wnd_alert_modal(response)},error:function(){wnd_alert_msg("系统错误！")}})}function wnd_ajax_embed(container,handle,param=0){$.ajax({type:"POST",url:ajaxurl,data:{handle:handle,param:param,ajax_type:"embed",action_name:"_wnd_ajax_r",action:"wnd_action"},beforeSend:function(){},success:function(response){wnd_reset_modal(),"object"==typeof response?wnd_alert_msg(response.msg):$(container).html(response)},error:function(){wnd_alert_msg("系统错误！")}})}function wnd_ajax_submit(form_id){var input_value=!0;if($(form_id+" input").each(function(){var required;if("required"==$(this).attr("required")){if(""==$(this).val())return input_value=!1,$(this).addClass("is-danger"),!1;if(("radio"==$(this).attr("type")||"checkbox"==$(this).attr("type"))&&$("[name="+$(this).attr("name")+"]:checked").length<=0)return input_value=!1,$(this).addClass("is-danger"),!1}}),!1===input_value)return wnd_ajax_msg('<span class="required">*</span>星标为必填项目！',"is-danger",form_id),!1;var option_value=!0;if($(form_id+" select option:selected").each(function(){var required=$(this).parent().attr("required");if(option_value=$(this).val(),"required"==required&&"-1"==option_value)return option_value=!1,$(form_id+" select").addClass("is-danger"),!1}),!1===option_value)return wnd_ajax_msg('<span class="required">*</span>星标为必选项目！',"is-danger",form_id),!1;if($(".wp-editor-area").length>0){var wp_editor_id=$(".wp-editor-area").attr("id"),content,editor=tinyMCE.get(wp_editor_id);content=editor?editor.getContent():$("#"+wp_editor_id).val(),$("#"+wp_editor_id).val(content)}var form_data=new FormData($(form_id).get(0));function showRequest(formData,jqForm,options){$(form_id+" [name='submit']").addClass("is-loading"),$(form_id+" [name='submit']").attr("disabled",!0)}function showResponse(response,statusText,xhr,$form){if($(form_id+" [name='submit']").removeClass("is-loading"),response.status<=0){var color="is-danger";$(form_id+" [name='submit']").attr("disabled",!1)}else var color="is-success";switch(response.status){case 1:wnd_ajax_msg(response.msg,color,form_id);break;case 2:wnd_ajax_msg('提交成功！<a href="'+response.msg+'" target="_blank">查看</a>',color,form_id);break;case 3:wnd_ajax_msg("提交成功！",color,form_id),$(window.location).attr("href",response.msg);break;case 4:window.location.reload(!0);break;case 5:wnd_alert_msg(response.msg,3);break;case 6:wnd_ajax_msg("下载中……",color,form_id,10),$(window.location).attr("href",response.msg);break;default:wnd_ajax_msg(response.msg,color,form_id)}}function showError(){wnd_ajax_msg("系统错误！","is-danger"),$(form_id+" [name='submit']").removeClass("is-loading"),$(form_id+" [name='submit']").attr("disabled",!1)}$.ajax({url:ajaxurl,dataType:"json",cache:!1,contentType:!1,processData:!1,data:form_data,type:"post",beforeSend:showRequest,success:showResponse,error:showError})}jQuery(document).ready(function($){$("body").off("click").on("click",".modal-background,.modal-close",function(){wnd_reset_modal()})}),jQuery(document).ready(function($){$("body").on("change","[type='file']",function(){var id="#"+$(this).data("id"),form_data=new FormData,file_data=$(this).prop("files")[0],meta_key=$(id+" [name='meta_key']").val(),post_parent=$(id+" [name='post_parent']").val(),_ajax_nonce=$(id+" [name='upload_nonce']").val(),save_width=$(id+" [name='save_width']").val(),save_height=$(id+" [name='save_height']").val(),is_image=$(id+" [name='is_image']").val();form_data.append("file",file_data),form_data.append("meta_key",meta_key),form_data.append("post_parent",post_parent),form_data.append("_ajax_nonce",_ajax_nonce),form_data.append("save_width",save_width),form_data.append("save_height",save_height),form_data.append("action","wnd_action"),form_data.append("action_name","wnd_upload_file"),$.ajax({url:ajaxurl,dataType:"json",cache:!1,contentType:!1,processData:!1,data:form_data,type:"post",beforeSend:function(){wnd_ajax_msg("正在处理，请勿关闭页面！","is-warning",id)},success:function(response){for(var i=0,n=response.length;i<n;i++)0!==response[i].status?(wnd_ajax_msg("上传成功！","is-success",id),1==is_image?$(id+" .thumbnail").prop("src",response[i].msg.url):$(id+" .file-name").html('上传成功！<a href="'+response[i].msg.url+'">查看文件</a>'),$(id+" .delete").data("file-id",response[i].msg.id)):wnd_ajax_msg(response[i].msg,"is-danger",id)},error:function(){wnd_ajax_msg("系统错误！","is-danger",id)}})}),$("body").on("click",".upload-field .delete",function(){if(!confirm("确定删除？"))return!1;var id="#"+$(this).data("id"),file_id=$(this).data("file-id");if(!file_id)return wnd_ajax_msg("没有可删除的文件！","is-danger",id),!1;var form_data=new FormData,meta_key=$(id+" [name='meta_key']").val(),post_parent=$(id+" [name='post_parent']").val(),_ajax_nonce=$(id+" [name='delete_nonce']").val(),is_image=$(id+" [name='is_image']").val(),thumbnail=$(id+" [name='thumbnail']").val();form_data.append("meta_key",meta_key),form_data.append("post_parent",post_parent),form_data.append("file_id",file_id),form_data.append("_ajax_nonce",_ajax_nonce),form_data.append("action","wnd_action"),form_data.append("action_name","wnd_delete_file"),$.ajax({url:ajaxurl,dataType:"json",cache:!1,contentType:!1,processData:!1,data:form_data,type:"post",beforeSend:function(){wnd_ajax_msg("删除中……","is-warning",id)},success:function(response){if(0===response.status)return wnd_ajax_msg(response.msg,"is-danger",id),!1;wnd_ajax_msg("已删除！","is-success",id),1==is_image?$(id+" .thumbnail").prop("src",thumbnail):$(id+" .file-name").text("文件已删除……"),$(id+" .delete").data("file-id",0)},error:function(){wnd_ajax_msg("系统错误！","is-danger",id)}})}),$("body").on("click",".send-code",function(){clearTimeout(send_countdown),wait=90;var _this=$(this),form_id="#"+_this.parents("form").attr("id"),verity_type=$(this).data("verity-type"),send_type=$(this).data("send-type"),template=$(this).data("template"),nonce=$(this).data("nonce"),phone=$(form_id+" input[name='phone']").val(),_user_user_email=$(form_id+" input[name='_user_user_email']").val();if(""==_user_user_email||""==phone)return wnd_ajax_msg("不知道发送到给谁……","is-danger",form_id),!1;$.ajax({type:"post",dataType:"json",url:ajaxurl,data:{action:"wnd_action",action_name:"wnd_ajax_send_code",email:_user_user_email,phone:phone,verity_type:verity_type,send_type:send_type,template:template,_ajax_nonce:nonce},beforeSend:function(){_this.addClass("is-loading")},success:function(response){if(response.status<=0)var color="is-danger";else{var color="is-success";_this.attr("disabled",!0),_this.text("已发送"),wnd_send_countdown()}wnd_ajax_msg(response.msg,color,form_id),_this.removeClass("is-loading")},error:function(){wnd_ajax_msg("发送失败！","is-danger",form_id),_this.removeClass("is-loading")}})}),$("body").on("change","form",function(){$("[name='submit']").attr("disabled",!1),$("button").attr("disabled",!1)}),$("body").on("input","input",function(){$(this).removeClass("is-danger")}),$("body").on("click",".menu a",function(){$(this).parents(".menu").find("a").removeClass("is-active"),$(this).addClass("is-active")}),$("body").on("click",".tabs a",function(){$(this).parent("li").addClass("is-active"),$(this).parent("li").siblings().removeClass("is-active")})});