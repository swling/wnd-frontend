async function _wnd_upload_to_oss(e,t,n,a=!0,i={}){function o(a){let o=e.name.split(".").pop(),s=e.type,l={extension:o,mime_type:s,method:r,oss_sp:t,endpoint:n,md5:a};l=Object.assign(l,i);let _=axios({url:wnd_action_api+"/common/"+d,method:"POST",data:l}).then(e=>e.data.data);return _}let d=a?"wnd_sign_oss_direct":"wnd_sign_oss_upload",s=new Blob([e]),r="PUT",l=await _wnd_md5_file(e),_=await o(l),c=axios({url:_.url,method:r,data:s,headers:_.headers,withCredentials:!1}).then(e=>_).catch(e=>{if(!a){let e=i.meta_key,t=_.id;_wnd_delete_attachment(t,e)}});return c}async function _wnd_md5_file(e){async function t(e){return new Promise((t,n)=>{function a(){const t=l*o,n=t+o>=e.size?e.size:t+o;r.readAsArrayBuffer(i.call(e,t,n))}const i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=2097152,d=Math.ceil(e.size/o),s=new SparkMD5.ArrayBuffer,r=new FileReader;let l=0;r.onload=function(e){s.append(e.target.result),l++,l<d?a():t(s.end())},r.onerror=function(e){n(e)},a()})}let n="";if("undefined"==typeof SparkMD5){let a=static_path+"js/lib/spark-md5.min.js"+cache_suffix;n=await wnd_load_script(a,function(){return t(e)})}else n=t(e);return n}function _wnd_delete_attachment(e,t=""){wnd_ajax_action("common/wnd_delete_file",{file_id:e,meta_key:t})}