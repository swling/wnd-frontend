async function _wnd_upload_to_oss(e,t,n,a=!0,i={}){function o(a){let o=e.name.split(".").pop(),s=e.type,l={extension:o,mime_type:s,method:_,oss_sp:t,endpoint:n,md5:a};l=Object.assign(l,i);let r=axios({url:wnd_action_api+"/common/"+d,method:"POST",data:l}).then(e=>e.data.data);return r}let d=a?"wnd_sign_oss_direct":"wnd_sign_oss_upload",s=new Blob([e]),_="PUT",l=await _wnd_md5_file(e),r=await o(l);if(r.is_duplicate)return r;let c=axios({url:r.put_url,method:_,data:s,headers:r.headers,withCredentials:!1}).then(e=>r).catch(e=>{if(!a){let e=i.meta_key,t=r.id;_wnd_delete_attachment(t,e)}});return c}async function _wnd_md5_file(e){async function t(e){return new Promise((t,n)=>{function a(){const t=l*o,n=t+o>=e.size?e.size:t+o;_.readAsArrayBuffer(i.call(e,t,n))}const i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=2097152,d=Math.ceil(e.size/o),s=new SparkMD5.ArrayBuffer,_=new FileReader;let l=0;_.onload=function(e){s.append(e.target.result),l++,l<d?a():t(s.end())},_.onerror=function(e){n(e)},a()})}let n="";if("undefined"==typeof SparkMD5){let e=static_path+"js/lib/spark-md5.min.js"+cache_suffix;await wnd_load_script(e)}return n=await t(e),n}function _wnd_delete_attachment(e,t=""){wnd_ajax_action("common/wnd_delete_file",{file_id:e,meta_key:t})}