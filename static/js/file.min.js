async function _wnd_upload_to_oss(e,t,n,a=!0,i={}){function o(a){let o=e.name.split(".").pop(),s=e.type,_={extension:o,mime_type:s,method:r,oss_sp:t,endpoint:n,md5:a};_=Object.assign(_,i);let l=axios({url:wnd_action_api+"/common/"+d,method:"POST",data:_}).then(e=>e.data.data);return l}let d=a?"wnd_sign_oss_direct":"wnd_sign_oss_upload",s=new Blob([e]),r="PUT",_=await _wnd_md5_file(e),l=await o(_);if(l.is_duplicate)return l;let c=axios({url:l.put_url,method:r,data:s,headers:l.headers,withCredentials:!1}).then(e=>l).catch(e=>{if(!a){let e=i.meta_key,t=l.id;_wnd_delete_attachment(t,e)}});return c}async function _wnd_md5_file(e){async function t(e){return new Promise((t,n)=>{function a(){const t=_*o,n=t+o>=e.size?e.size:t+o;r.readAsArrayBuffer(i.call(e,t,n))}const i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=2097152,d=Math.ceil(e.size/o),s=new SparkMD5.ArrayBuffer,r=new FileReader;let _=0;r.onload=function(e){s.append(e.target.result),_++,_<d?a():t(s.end())},r.onerror=function(e){n(e)},a()})}let n="";if("undefined"==typeof SparkMD5){let e=static_path+"js/lib/spark-md5.min.js"+cache_suffix;await wnd_load_script(e)}return n=await t(e),n}function _wnd_delete_attachment(e,t=""){wnd_ajax_action("common/wnd_delete_file",{file_id:e,meta_key:t})}async function _wnd_delete_oss_file(e,t,n){function a(){let a={method:o,oss_sp:t,endpoint:n,file:e};return axios({url:wnd_action_api+"/common/"+i,method:"POST",data:a}).then(e=>e.data.data)}let i="wnd_sign_oss_direct",o="DELETE",d=await a(e);return axios({url:d.delete_url,method:o,headers:d.headers,withCredentials:!1}).then(e=>d).catch(e=>{console.error(e)})}