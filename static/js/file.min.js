async function _wnd_upload_to_oss(e,t,n,i=!0,a={}){function o(i){let o=e.name.split(".").pop(),r=e.type,l={extension:o,mime_type:r,method:s,oss_sp:t,endpoint:n,md5:i};l=Object.assign(l,a);let _=axios({url:wnd_action_api+"/common/"+d,method:"POST",data:l}).then(e=>e.data.data);return _}let d=i?"wnd_sign_oss_direct":"wnd_sign_oss_upload",r=new Blob([e]),s="PUT",l=await _wnd_md5_file(e),_=await o(l);if(_.is_duplicate)return _;let c=axios({url:_.put_url,method:s,data:r,headers:_.headers,withCredentials:!1}).then(e=>_).catch(e=>{if(!i){let e=a.meta_key,t=_.id;_wnd_delete_attachment(t,e)}});return c}async function _wnd_md5_file(e){async function t(e){return new Promise((t,n)=>{function i(){const t=l*o,n=t+o>=e.size?e.size:t+o;s.readAsArrayBuffer(a.call(e,t,n))}const a=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=2097152,d=Math.ceil(e.size/o),r=new SparkMD5.ArrayBuffer,s=new FileReader;let l=0;s.onload=function(e){r.append(e.target.result),l++,l<d?i():t(r.end())},s.onerror=function(e){n(e)},i()})}let n="";if("undefined"==typeof SparkMD5){let i=static_path+"js/lib/spark-md5.min.js"+cache_suffix;n=await wnd_load_script(i,function(){return t(e)})}else n=t(e);return n}function _wnd_delete_attachment(e,t=""){wnd_ajax_action("common/wnd_delete_file",{file_id:e,meta_key:t})}