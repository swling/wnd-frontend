function _wnd_render_form(e,t,l="",s){let a=["text","number","email","password","url","color","date","range","tel"],i=JSON.parse(JSON.stringify(t)),n=document.querySelector(e);l&&n.classList.add(l);let d={template:function e(t){let l=e;function s(){return`\n<form v-bind="form.attrs">\n<div v-if="form.before_html" v-html="form.before_html"></div>\n<div class="field" v-show="form.title.title"><h3 v-bind="form.title.attrs" v-html="form.title.title"></h3></div>\n<div v-bind="form.message.attrs" class="notification is-light" v-show="form.message.message" v-html="form.message.message"></div>\n${function(e){let t="";for(let i=0;i<e.fields.length;i++){let n=e.fields[i],d=`form.fields[${i}]`;if(s()&&(t+=`\n<div class="field is-horizontal">\n<div class="field-label ${e.size}">\n<label v-if="${d}.label" class="label is-hidden-mobile"><span v-if="${d}.required" class="required">*</span>{{${d}.label}}</label>\n</div>\n<div class="field-body">`),"html"==n.type)t+=n.value;else if(a.includes(n.type))t+=l.build_text(d,i);else if("radio"==n.type||"checkbox"==n.type)t+=l.build_radio(d,i);else if("hidden"==n.type)t+='<input v-bind="parse_input_attr('+d+')" v-model="'+d+'.value" />';else{let e="build_"+n.type;t+=l[e](d,i)}function s(){return e.attrs["is-horizontal"]&&!["html","hidden"].includes(n.type)}s()&&(t+="</div></div>")}return t}(t)}\n${function(e){return`\n<div v-if="form.submit.text" class="field has-text-centered">\n<button type="button" v-bind="form.submit.attrs" @click="submit($event)" class="${e.size}" v-text="form.submit.text"></button>\n</div>`}(t)}\n<div class="form-script"></div>\n<div v-if="form.after_html" v-html="form.after_html"></div>\n</form>`}return build_label=(e,t)=>`<label v-if="!form.attrs['is-horizontal'] && ${e}.label" class="label" :class="form.size"><span v-if="${e}.required" class="required">*</span>{{${e}.label}}</label>`,l.build_text=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<div v-if="${e}.addon_left" class="control" v-html="${e}.addon_left"></div>\n<div :class="get_control_class(${e})">\n<input v-bind="parse_input_attr(${e})" :value="html_decode(${e}.value)" @input="${e}.value=html_encode($event.target.value)" @change="change(${e}, $event)" @keypress.enter="submit"/>\n<span v-if="${e}.icon_left" class="icon is-left"  v-html="${e}.icon_left"></span>\n<span v-if="${e}.icon_right" class="icon is-right" v-html="${e}.icon_right"></span>\n</div>\n<div v-if="${e}.addon_right" class="control" v-html="${e}.addon_right"></div>\n<p v-if="!has_addon(${e})" v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,l.build_radio=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<div :class="get_control_class(${e})">\n<template v-for="(radio_value, radio_label) in ${e}.options">\n<label :class="${e}.type">\n<input v-bind="parse_input_attr(${e})" :value="radio_value" v-model="${e}.checked" @change="change(${e}, $event)" :disabled="should_be_disabled(${e}, radio_value)">\n{{radio_label}}</label>\n</template>\n</div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,l.build_select=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<div v-if="${e}.addon_left" class="control" v-html="${e}.addon_left"></div>\n<div :class="get_control_class(${e})">\n<div class="select" :class="${e}.class + ' ' + form.size">\n<select v-bind="parse_input_attr(${e})" v-model="${e}.selected" @change="change(${e}, $event)">\n<option disabled value="">- {{${e}.label}} -</option>\n<option v-for="(value, name) in ${e}.options" :value="value">{{name}}</option>\n</select>\n</div>\n<span v-if="${e}.icon_left" class="icon is-left"  v-html="${e}.icon_left"></span>\n<span v-if="${e}.icon_right" class="icon is-right" v-html="${e}.icon_right"></span>\n</div>\n<div v-if="${e}.addon_right" class="control" v-html="${e}.addon_right"></div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,l.build_select_linked=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<div v-if="${e}.addon_left" class="control" v-html="${e}.addon_left"></div>\n<div :class="get_control_class(${e})">\n<div class="select">\n<select class="select" style="display:inline-block" :class="${e}.class + ' ' + form.size" v-bind="parse_input_attr(${e})" v-for="(option, key) in ${e}.options" v-model="${e}.selected[key]" @change="selected($event, key, ${t})" :key="key">\n<option disabled value="">- {{${e}.label}} -</option>\n<option v-for="(v,k ) in option" :value="v" :key="v">{{k}}</option>\n</select>\n</div>\n<span v-if="${e}.icon_left" class="icon is-left"  v-html="${e}.icon_left"></span>\n<span v-if="${e}.icon_right" class="icon is-right" v-html="${e}.icon_right"></span>\n</div>\n<div v-if="${e}.addon_right" class="control" v-html="${e}.addon_right"></div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,l.build_textarea=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<textarea :value="html_decode(${e}.value)" @input="${e}.value = html_encode($event.target.value)" v-bind="parse_input_attr(${e})" @change="change(${e}, $event)"></textarea>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,l.build_file_upload=(e,t)=>`\n<div :id="get_field_id(${e},${t})" class="field" :class="${e}.class">\n<div v-if="${e}.complete" class="field">\n<progress class="progress is-primary" :value="${e}.complete" max="100"></progress>\n</div>\n<div class="columns is-mobile is-vcentered">\n\n<div class="column">\n<div class="file has-name is-fullwidth" :class="form.size">\n<label class="file-label">\n<input type="file" class="file file-input" :name="${e}.name" @change="upload($event,${e})">\n<span class="file-cta">\n<span class="file-icon"><i class="fa fa-upload"></i></span>\n</span>\n<span class="file-name" v-html="${e}.file_name"></span>\n</label>\n</div>\n</div>\n\n<div v-show="${e}.delete_button && ${e}.file_id" class="column is-narrow">\n<a class="delete" @click="delete_file(${e},${t})"></a>\n</div>\n\n</div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class" style="margin-top:-1rem;">{{${e}.help.text}}</p>\n</div>`,l.build_image_upload=(e,t)=>`\n<div :id="get_field_id(${e},${t})" class="field" :class="${e}.class">\n<div v-if="${e}.complete">\n<progress class="progress is-primary" :value="${e}.complete" max="100"></progress>\n</div>\n\n${build_label(e)}\n<a @click="click_target('#' + get_field_id(${e}, ${t}) + ' input[type=file]')">\n<img class="thumbnail" :src="${e}.thumbnail" :height="${e}.thumbnail_size.height" :width="${e}.thumbnail_size.width">\n</a>\n<a v-show="${e}.delete_button && ${e}.file_id" class="delete" @click="delete_file(${e}, ${t})"></a>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n<div class="file"><input type="file" class="file file-input" accept="image/*" :name="${e}.name" @change="upload($event,${e})"></div>\n</div>`,s()}(i),data:()=>({form:i,index:{captcha:"",ids:[]},default_data:{}}),methods:{html_encode:function(e){let t=document.createElement("div");t.innerText=e;let l=t.innerHTML;return t=null,l},html_decode:function(e){var t=document.createElement("div");t.innerHTML=e;var l=t.innerText;return t=null,l},has_addon:function(e){return e.addon_left||e.addon_right},has_icon:function(e){return e.icon_left||e.icon_right},get_field_class:function(e){return this.has_addon(e)?"field has-addons":"field"},get_control_class:function(e){let t="control";return t+=this.has_addon(e)?" is-expanded":"",t+=e.icon_left?" has-icons-left":"",t+=e.icon_right?" has-icons-right":"",t},get_field_id:function(e,t){return e.id||this.form.attrs.id+"-"+t},get_value:function(e){let t=["checkbox","radio"].includes(e.type)?[]:"",l=e.checked||e.selected;return e.value?t=e.value:l&&("object"!=typeof l||l.length||Object.keys(l).length)&&(t=e.checked||e.selected),t="object"==typeof t?Object.values(t):t,t},parse_input_attr:function(e,t=[]){let l=JSON.parse(JSON.stringify(e));return Object.keys(l).forEach((e=>{l[e]&&""!=l[e]||delete l[e]})),t.forEach((e=>{delete l[e]})),l.class=(a.includes(e.type)?"input":e.type)+" "+(l.class||""),l.class+=" "+this.form.size,delete l.icon_left,delete l.icon_right,delete l.addon_left,delete l.addon_right,delete l.options,delete l.label,delete l.help,delete l.value,delete l.checked,delete l.selected,delete l.options,"file_upload"==l.type?l.type="file":"select"!=l.type&&"select_linked"!=l.type||delete l.type,delete l.data,delete l.linkage,l},click_target(e){document.querySelector(e).click()},should_be_disabled:function(e,t){if("checkbox"==e.type&&e.max>0){let l=e.checked;if(l.length>=e.max&&!l.includes(t))return!0}return!1},change:async function(e,t){if(e.linkage){let s=t.target.value,a=e.linkage.query||!1,i=e.linkage.data&&e.linkage.data[s]||!1,n=e.linkage.params||{};if(n[e.name]=s,i)l(this,i);else if(a){l(this,(await wnd_query(a,n)).data)}function l(t,l){e.linkage.fields.forEach((e=>{let s=t.index.ids[e],a=t.form.fields[s];a=Object.assign(a,l)}))}}e.class=e.class.replace("is-danger",""),e.help.class=e.help.class.replace("is-danger",""),e.help.text=e.help.text.replace(" "+wnd.msg.required,"")},selected:async function(e,t,l){let s=this.form.fields[l],a=s.data.query,i=Object.assign(s.data.params,{parent:e.target.value});this.change(s);let n=(await wnd_query(a,i)).data;Object.keys(n).length?(s.options.splice(t+1,s.options.length,n),s.selected[t+1]=""):(s.options.splice(t+1,s.options.length),s.selected.length=t+1)},upload:function(e,t){let l=e.target.files,s=new FormData,a=this;if(t.data)for(const e in t.data)s.append(e,t.data[e]);for(let e=0,c=l.length;e<c;e++)l[e].type.includes("image/")&&(t.data.save_width||t.data.save_height)?i(e,l[e]):a.form.attrs["data-oss-direct-upload"]?d(l[e]):(s.set("wnd_file["+e+"]",l[e]),n());function i(e,l){let i=new Image,c=new FileReader;c.onload=function(){var o=c.result;i.src=o,i.onload=function(c){!function(e,l,i){let c=document.createElement("canvas");c.width=t.data.save_width,c.height=t.data.save_height;let o=Math.max(c.width/l.naturalWidth,c.height/l.naturalHeight),r=c.getContext("2d");r.scale(o,o);var h=(r.canvas.width/o-l.naturalWidth)/2,f=(r.canvas.height/o-l.naturalHeight)/2;r.drawImage(l,h,f),c.toBlob((t=>{let l=new File([t],e.name,{type:e.type});s.append("wnd_file["+i+"]",l),a.form.attrs["data-oss-direct-upload"]?d(l):n()}),e.type)}(l,i,e)}},c.readAsDataURL(l)}function n(){axios({url:wnd_action_api+"/common/wnd_upload_file",method:"post",data:s,headers:{},onUploadProgress:function(e){t.help.text=wnd.msg.waiting,t.help.class="is-primary"}}).then((e=>{if(e.data.status<=0)t.help.text=e.data.msg,t.help.class="is-danger";else{let l=e.data.data;for(let e=0,s=l.length;e<s;e++)l[e].status<=0?(t.help.text=l[e].msg,t.help.class="is-danger"):(t.help.text=wnd.msg.upload_successfully,t.help.class="is-success",t.thumbnail=l[e].thumbnail,t.file_id=l[e].id,t.file_name=wnd.msg.upload_successfully+'&nbsp<a href="'+l[e].url+'" target="_blank">'+wnd.msg.view+"</a>"),"image_upload"==t.type||"file_upload"==t.type||t.type}})).catch((e=>{}))}async function d(e){let l=await wnd_upload_to_oss(e,t.data);l?(t.help.text=wnd.msg.upload_successfully,t.help.class="is-success",t.thumbnail=l.signed_url||l.url,t.file_id=l.id,t.file_name=wnd.msg.upload_successfully+'&nbsp<a href="'+(l.signed_url||l.url)+'" target="_blank">'+wnd.msg.view+"</a>"):(t.help.text=wnd.msg.upload_failed,t.help.class="is-danger")}},delete_file:function(e,l){if(!e.file_id)return e.file_name="Error",!1;let s=new FormData;s.append("file_id",e.file_id),s.append("meta_key",e.data.meta_key),axios({url:wnd_action_api+"/common/wnd_delete_file",method:"post",data:s}).then((s=>{if(s.data.status<=0)return wnd_alert_notification(s.data.msg,"is-danger"),!1;e.thumbnail=t.fields[l].default_thumbnail,e.file_name=wnd.msg.deleted,e.file_id=0,"image_upload"==e.type||"file_upload"==e.type||e.type})).catch((e=>{}))},formdata_to_object:function(e){let t={};return e.forEach(((e,l)=>{l.includes("[]")?(l=l.replace("[]",""),Reflect.has(t,l)?t[l].push(e):t[l]=[e]):t[l]=e})),t},submit:function(e){if(this.form.submit.attrs.class=t.submit.attrs.class+" is-loading",this.index.captcha){if(!this.form.fields[this.index.captcha].value)return void wnd_submit_via_captcha(e)}let l=!0;for(const[e,s]of this.form.fields.entries()){if(!s.name||!s.required)continue;let a=!0,i=this.get_value(s);Object.values(s.options).includes(i)||("string"!=typeof i||i.length?Array.isArray(i)&&i.every((e=>!e))?a=!1:i||0===i||(a=!1):a=!1,a||(s.class=t.fields[e].class+" is-danger",s.help.class=t.fields[e].help.class+" is-danger",s.help.text=t.fields[e].help.text+" "+wnd.msg.required,l=!1))}if(!l)return this.form.submit.attrs.class=t.submit.attrs.class,!1;let s=document.querySelector("#"+this.form.attrs.id),a=new FormData(s),i=JSON.parse(JSON.stringify(this.default_data)),d=Object.assign(i,this.formdata_to_object(a)),c={};"get"==this.form.attrs.method.toLowerCase()&&(c=d),axios({method:this.form.attrs.method,url:this.form.attrs.action,data:d,params:c}).then((e=>{info=wnd_handle_response(e.data,this.form.attrs.route,n),this.form.message.message=!1===info.msg?this.form.message.message:info.msg,this.form.message.attrs.class=t.message.attrs.class+" "+info.msg_class,this.form.submit.attrs.class=t.submit.attrs.class,this.index.captcha&&(this.form.fields[this.index.captcha].value="")})).catch((function(e){}))},reload:async function(e){let t=await axios({method:"get",url:s});this.form=t.data.data.structure}},created(){for(let e=0,t=this.form.fields.length;e<t;e++){let t=this.form.fields[e];if("captcha"!=t.name||""!=t.value)if("select_linked"!=t.type){if(t.name){let e=t.name.replace("[]","");this.default_data[e]=""}t.id&&(this.index.ids[t.id]=e)}else{let e=Object.keys(t.selected)[Object.keys(t.selected).length-1],l=parseInt(e)+1;t.selected[l]=""}else this.index.captcha=e}},mounted(){wnd_inner_html(`#${this.form.attrs.id} .form-script`,this.form.script),funTransitionHeight(n,trs_time),document.addEventListener("keydown",(e=>{"F8"===e.key&&(e.preventDefault(),this.reload())}))},updated(){funTransitionHeight(n,trs_time)}};Vue.createApp(d).mount(e)}