function _wnd_render_form(e,t,n=""){function s(e){return`\n<form v-bind="form.attrs">\n<div v-if="form.before_html" v-html="form.before_html"></div>\n<div class="field" v-show="form.title.title"><h3 v-bind="form.title.attrs" v-html="form.title.title"></h3></div>\n<div v-bind="form.message.attrs" class="message" v-show="form.message.message"><div class="message-body" v-html="form.message.message"></div></div>\n${a(e)}\n${i(e)}\n<div class="form-script"></div>\n<div v-if="form.after_html" v-html="form.after_html"></div>\n</form>`}function i(e){return e.step_index.length>0?`\n</div><!-- 关闭最后一个 step -->\n<div class="navbar is-fixed-bottom">\n<div class="navbar-end container">\n<div class="buttons">\n<button v-show="step > 0" type="button"  class="button" @click="nextPrev(-1)">{{index.step[step - 1] || 'Previous'}}</button>\n<button v-show="step < form.step_index.length - 1"  type="button"  class="button" @click="nextPrev(1)">{{index.step[step + 1]|| 'Next'}}</button>\n<button :disabled="step != form.step_index.length - 1" type="button" v-bind="form.submit.attrs" @click="submit($event)" class="${e.size} is-${e.primary_color}" v-text="form.submit.text"></button>\n</div>\n</div>\n</div>`:`\n<div v-if="form.submit.text" class="field is-grouped is-grouped-centered">\n<button type="button" v-bind="form.submit.attrs" @click="submit($event)" class="${e.size}" v-text="form.submit.text"></button>\n</div>`}function a(e){let t="";for(let s=0;s<e.fields.length;s++){let i=e.fields[s],a=`form.fields[${s}]`;function n(){return e.attrs["is-horizontal"]&&!["html","hidden","editor"].includes(i.type)&&"_post_post_title"!=i.name}"step"!=i.type?(n()&&(t+=`\n<div class="field is-horizontal">\n<div class="field-label ${e.size}">\n<label v-if="${a}.label" class="label is-hidden-mobile"><span v-if="${a}.required" class="required">*</span>{{${a}.label}}</label>\n</div>\n<div class="field-body">`),"html"==i.type?t+=i.value:g.includes(i.type)?t+=l(a,s):"radio"==i.type||"checkbox"==i.type?t+=o(a,s):"hidden"==i.type?t+='<input v-bind="parse_input_attr('+a+')" v-model="'+a+'.value" />':"textarea"==i.type?t+=d(a,s):"editor"==i.type?t+=u(a,s):"image_upload"==i.type?t+=p(a,s):"file_upload"==i.type?t+=c(a,s):"select"==i.type?t+=r(a,s):"tag_input"==i.type&&(t+=m(a,s)),n()&&(t+="</div></div>")):t+=h(e.step_index,s)}return t}function l(e,t){return`\n<div :class="get_field_class(${e})">\n${f(e)}\n<div v-if="${e}.addon_left" class="control" v-html="${e}.addon_left"></div>\n<div :class="get_control_class(${e})">\n<input v-bind="parse_input_attr(${e})" :value="Html_decode(${e}.value)" @input="${e}.value = Html_encode($event.target.value)" @change="change(${e})" @keypress.enter="submit"/>\n<span v-if="${e}.icon_left" class="icon is-left"  v-html="${e}.icon_left"></span>\n<span v-if="${e}.icon_right"  class="icon is-right" v-html="${e}.icon_right"></span>\n</div>\n<div v-if="${e}.addon_right" class="control" v-html="${e}.addon_right"></div>\n<p v-if="!has_addon(${e})" v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`}function o(e,t){return`\n<div :class="get_field_class(${e})">\n${f(e)}\n<div :class="get_control_class(${e})">\n<template v-for="(radio_value, radio_label) in ${e}.options">\n<label :class="${e}.type">\n<input v-bind="parse_input_attr(${e})" :value="radio_value" v-model="${e}.checked" @click="change(${e})">\n{{radio_label}}</label>\n</template>\n</div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`}function r(e,t){return`\n<div class="field">\n${f(e)}\n<div class="control">\n<div class="select" :class="${e}.class + ' ' + form.size" @change="change(${e})">\n<select v-bind="parse_input_attr(${e})" v-model="${e}.selected">\n<template v-for="(value, name) in ${e}.options">\n<option :value="value">{{name}}</option>\n</template>\n</select>\n</div>\n</div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`}function d(e,t){return`\n<div :class="get_field_class(${e})">\n${f(e)}\n<textarea :value="Html_decode(${e}.value)" @input="${e}.value = Html_encode($event.target.value)" v-bind="parse_input_attr(${e})" @change="change(${e})"></textarea>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`}function c(e,t){return`\n<div :id="get_field_id(${e},${t})" class="field" :class="${e}.class">\n<div v-if="${e}.complete" class="field">\n<progress class="progress is-primary" :value="${e}.complete" max="100"></progress>\n</div>\n<div class="columns is-mobile is-vcentered">\n\n<div class="column">\n<div class="file has-name is-fullwidth" :class="form.size">\n<label class="file-label">\n<input type="file" class="file file-input" :name="${e}.name" @change="upload($event,${e})">\n<span class="file-cta">\n<span class="file-icon"><i class="fa fa-upload"></i></span>\n</span>\n<span class="file-name" v-html="${e}.file_name"></span>\n</label>\n</div>\n</div>\n\n<div v-show="${e}.delete_button && ${e}.file_id" class="column is-narrow">\n<a class="delete" @click="delete_file(${e},${t})"></a>\n</div>\n\n</div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class" style="margin-top:-1rem;">{{${e}.help.text}}</p>\n</div>`}function p(e,t){return`\n<div :id="get_field_id(${e},${t})" class="field" :class="${e}.class">\n<div v-if="${e}.complete">\n<progress class="progress is-primary" :value="${e}.complete" max="100"></progress>\n</div>\n\n${f(e)}\n<a @click="click_target('#' + get_field_id(${e}, ${t}) + ' input[type=file]')">\n<img class="thumbnail" :src="${e}.thumbnail" :height="${e}.thumbnail_size.height" :width="${e}.thumbnail_size.width">\n</a>\n<a v-show="${e}.delete_button && ${e}.file_id" class="delete" @click="delete_file(${e}, ${t})"></a>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n<div class="file"><input type="file" class="file file-input" accept="image/*" :name="${e}.name" @change="upload($event,${e})"></div>\n</div>`}function u(e,t){return`\n<div :class="get_field_class(${e})">\n<div :id="form.attrs.id + '-${t}-toolbar'" class="editor-toolbar"></div>\n<div :id="form.attrs.id + '-${t}-text'" class="editor-text"></div>\n${f(e)}\n<textarea style="display:none" v-model="${e}.value" v-bind="parse_input_attr(${e})" @change="change(${e})"></textarea>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`}function m(e,t){let n=document.createElement("style");n.innerHTML="\n.tags-input{width:100%;border-bottom:1px solid #ccc}\n.tags-input input{border:none;width:100%;font-size:1rem;padding-top:0!important;padding-bottom:0!important}\n.tags-input input:focus{border:none;box-shadow:none;outline:0;padding-top:0!important;padding-bottom:0!important}\n.tags-input .tag{margin:5px}\n.tags-input .autocomplete{position:relative;display:inline-block}\n.tags-input .autocomplete-items{position:absolute;box-shadow:0 2px 10px #999;border-bottom:none;border-top:none;z-index:99;top:100%;left:0}\n.tags-input .autocomplete-items li{padding:10px;cursor:pointer;background-color:#fff;border-bottom:1px solid #eee}\n.tags-input .autocomplete-items li:hover{background-color:#eee}",document.head.appendChild(n);let s=`\n<template v-for="(tag, index) in ${e}.tags">\n<span class="tag is-medium is-light is-danger">{{tag}}<span class="delete is-small" @click="delete_tag(tag, ${t})"></span></span>\n</template>`,i=`\n<template v-for="(tag, index) in ${e}.suggestions">\n<li @click="enter_tag_by_sg($event, ${t})">{{tag}}</li>\n</template>`;return`\n<div :class="get_field_class(${e})">\n${f(e)}\n<div class="tags-input columns is-marginless">\n<div class="column is-marginless is-paddingless is-narrow">${s}</div>\n<div class="autocomplete column is-marginless">\n<input type="text" :readonly="${e}.tags.length >= max_tag_num" @input="suggest_tags($event.target.value, ${t})" @keypress.enter="enter_tag($event, ${t})" @click="handle_tag_input_click($event, ${t})"/>\n<input type="hidden" v-bind="parse_input_attr(${e})" v-model="${e}.tags" />\n<ul v-show="${e}.tags.length < max_tag_num" class="autocomplete-items">${i}</ul>\n</div>\n</div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`}function f(e){return`<label v-if="!form.attrs['is-horizontal'] && ${e}.label" class="label" :class="form.size"><span v-if="${e}.required" class="required">*</span>{{${e}.label}}</label>`}function h(e,t){return t==e[0]?'<div class="step">':'</div><div class="step" style="display:none">'}let g=["text","number","email","password","url","color","date","range","tel"],v=JSON.parse(JSON.stringify(t)),_=document.querySelector(e);n&&_.classList.add(n),wnd_inner_html(_,'<div class="vue-app"></div>'),new Vue({el:e+" .vue-app",template:s(v),data:{form:v,index:{editor:[],captcha:"",step:[]},step:0},methods:{Html_encode:function(e){let t=document.createElement("div");t.innerText=e;let n=t.innerHTML;return t=null,n},Html_decode:function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.innerText;return t=null,n},has_addon:function(e){return e.addon_left||e.addon_right},has_icon:function(e){return e.icon_left||e.icon_right},get_field_class:function(e){return this.has_addon(e)?"field has-addons":"field"},get_control_class:function(e){let t="control";return t+=this.has_addon(e)?" is-expanded":"",t+=e.icon_left?" has-icons-left":"",t+=e.icon_right?" has-icons-right":"",t},get_field_id:function(e,t){return e.id||this.form.attrs.id+"-"+t},parse_input_attr:function(e){let t=JSON.parse(JSON.stringify(e));return Object.keys(t).forEach(e=>{t[e]&&""!=t[e]||delete t[e]}),t.class=(g.includes(e.type)?"input":e.type)+" "+(t.class||""),t.class+=" "+this.form.size,delete t.icon_left,delete t.icon_right,delete t.addon_left,delete t.addon_right,delete t.options,delete t.label,delete t.help,delete t.value,delete t.field,"file_upload"==t.type&&(t.type="file"),delete t.data,t},build_editor:function(){function e(){a.index.editor.forEach(e=>{t(e)})}function t(e){const t=window.wangEditor,{$:i,BtnMenu:l}=t;class o extends l{constructor(e){const n=t.$('<div class="w-e-menu" data-title="切割免费内容与付费内容"><i class="fas fa-yen-sign"></i></div>');super(n,e)}clickHandler(){let e='<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-wp-more="more" class="wp-more-tag" title="\'Read more..." />';c.cmd.do("insertHTML",e)}tryChangeActive(){}}t.registerMenu("moreMenuKey",o);let r=a.form.fields[e],d=`#${a.form.attrs.id}-${e}`;const c=new wangEditor(`${d}-toolbar`,`${d}-text`);c.config.uploadImgHeaders={"X-WP-Nonce":wnd.rest_nonce},c.config.uploadImgServer=wnd_action_api+"/wnd_upload_file_editor",c.config.uploadFileName="wnd_file[]",c.config.uploadImgParams={type:"wangeditor",post_parent:a.form.attrs["data-post-id"]||0,_ajax_nonce:r._ajax_nonce},c.config.showLinkImg=!1,c.config.onchange=(e=>{r.value=s(e),_.style.removeProperty("height")}),c.config.excludeMenus=["fontSize","fontName","indent","todo","lineHeight","emoticon","video"],c.config.zIndex=9,c.config.menuTooltipPosition="down",c.create(),c.txt.html(n(r.value)),a.$nextTick(function(){funTransitionHeight(_,trs_time)})}function n(e){if(-1!==e.indexOf("<!--more")){let t="Read more...";e=e.replace(/<!--more(.*?)-->/g,function(e,n){return'<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-wp-more="more" data-wp-more-text="'+n+'" class="wp-more-tag mce-wp-more" alt="" title="'+t+'" />'})}return e}function s(e){let t="<!--more-->";return e=e.replace(/<img[^>]+>/g,function(e){let n,s="";return-1!==e.indexOf('data-wp-more="more"')&&((n=e.match(/data-wp-more-text="([^"]+)"/))&&(moretext=n[1]),s=t),s||e}),e.replace(`<p>${t}</p>`,t)}let i=document.createElement("style");i.innerHTML=`\nimg[data-wp-more] {\n    border: 0; box-shadow: none; width: 96%; height: 16px; display: block; margin: 15px auto 0; outline: 0; cursor: default;\n\tbackground: transparent url( ${static_path}/images/more.png ) repeat-y scroll center center;\n}`,document.head.appendChild(i);let a=this;if("undefined"==typeof wangEditor){let t=static_path+"editor/wangEditor.min.js?ver="+wnd.ver;wnd_load_script(t,function(){e()})}else e()},click_target(e){document.querySelector(e).click()},change:function(e){e.class=e.class.replace("is-danger",""),e.help.class=e.help.class.replace("is-danger",""),e.help.text=e.help.text.replace(" "+wnd.msg.required,""),this.$nextTick(function(){funTransitionHeight(_,trs_time)})},upload:function(e,t){let n=e.target.files,s=new FormData;if(t.data)for(const e in t.data)s.append(e,t.data[e]);for(let e=0,t=n.length;e<t;e++)s.set("wnd_file["+e+"]",n[e]);s.set("_ajax_nonce",t.data.upload_nonce),axios({url:wnd_action_api+"/wnd_upload_file",method:"post",data:s,headers:{},onUploadProgress:function(e){t.help.text=wnd.msg.waiting,t.help.class="is-primary"}}).then(e=>{for(let n=0,s=e.data.length;n<s;n++)e.data[n].status<=0?(t.help.text=e.data[n].msg,t.help.class="is-danger"):(t.help.text=wnd.msg.upload_successfully,t.help.class="is-success",t.thumbnail=e.data[n].data.thumbnail,t.file_id=e.data[n].data.id,t.file_name=wnd.msg.upload_successfully+'&nbsp<a href="'+e.data[n].data.url+'" target="_blank">'+wnd.msg.view+"</a>"),"image_upload"==t.type||"file_upload"==t.type||t.type;this.$nextTick(function(){funTransitionHeight(_,trs_time)})}).catch(e=>{console.log(e)})},delete_file:function(e,n){if(!e.file_id)return e.file_name="Error",!1;let s=new FormData;s.append("file_id",e.file_id),s.append("meta_key",e.data.meta_key),s.append("_ajax_nonce",e.data.delete_nonce),axios({url:wnd_action_api+"/wnd_delete_file",method:"post",data:s}).then(s=>{e.thumbnail=t.fields[n].default_thumbnail,e.file_name=wnd.msg.deleted,e.file_id=0,"image_upload"==e.type||"file_upload"==e.type||e.type}).catch(e=>{console.log(e)})},suggest_tags:function(e,t){let n={search:e,taxonomy:this.form.fields[t].taxonomy};axios({method:"get",url:wnd_jsonget_api+"/wnd_term_searcher",params:n}).then(e=>{this.form.fields[t].suggestions=e.data.data})},enter_tag:function(e,t){if(!e.target.value||this.form.fields[t].tags.length>=max_tag_num)return!1;this.form.fields[t].tags.push(e.target.value.trim()),e.target.value=""},enter_tag_by_sg:function(e,t){this.form.fields[t].tags.push(e.target.innerText.trim()),this.form.fields[t].suggestions="";let n=e.target.closest(".tags-input").querySelector("[type=text]");n.value=""},delete_tag:function(e,t){this.form.fields[t].tags=this.form.fields[t].tags.filter(function(t){return t!==e})},handle_tag_input_click:function(e,t){this.form.fields[t].tags.length>=max_tag_num&&(this.form.fields[t].help.text="最多"+max_tag_num+"个标签")},nextPrev:function(e){funTransitionHeight(_);var t=document.getElementsByClassName("step");if(t[this.step].style.display="none",this.step=this.step+e,this.step>=t.length)return!1;t[this.step].style.removeProperty("display"),funTransitionHeight(_,trs_time)},submit:function(e){if(this.form.submit.attrs.class=t.submit.attrs.class+" is-loading",this.index.captcha){let t=this.form.fields[this.index.captcha];if(!t.value)return void wnd_submit_via_captcha(e)}let n=!0;for(const[e,s]of this.form.fields.entries())!s.required||s.value||s.selected||s.checked||(s.class=t.fields[e].class+" is-danger",s.help.class=t.fields[e].help.class+" is-danger",s.help.text=t.fields[e].help.text+" "+wnd.msg.required,n=!1);if(!n)return this.form.submit.attrs.class=t.submit.attrs.class,this.$nextTick(function(){funTransitionHeight(_,trs_time)}),!1;let s=document.querySelector("#"+this.form.attrs.id),i=new FormData(s),a={};"get"==this.form.attrs.method.toLowerCase()&&(a=Object.fromEntries(i)),axios({method:this.form.attrs.method,url:this.form.attrs.action,data:i,params:a}).then(e=>{info=wnd_handle_response(e.data,this.form.attrs.route,_),this.form.message.message=info.msg,this.form.message.attrs.class=t.message.attrs.class+" "+info.msg_class,this.form.submit.attrs.class=t.submit.attrs.class,this.index.captcha&&Vue.set(this.form.fields[this.index.captcha],"value",""),this.$nextTick(function(){funTransitionHeight(_,trs_time)})}).catch(function(e){console.log(e)})}},mounted(){this.form.fields.forEach((e,t)=>{"captcha"==e.name&&""==e.value&&(this.index.captcha=t),"editor"==e.type&&this.index.editor.push(t),"step"==e.type&&this.index.step.push(e.text)}),this.index.editor&&this.build_editor(),funTransitionHeight(_,trs_time),wnd_inner_html(`#${this.form.attrs.id} .form-script`,this.form.script)},computed:{},watch:{}})}var max_tag_num=void 0!==max_tag_num?max_tag_num:3;document.addEventListener("click",function(e){let t=e.target.closest("button");if(!t)return;let n=t.closest("form");if(!n)return;let s=n.parentNode;if(t.classList.contains("add-row")){let e=t.closest(".field");t.classList.remove("add-row"),t.classList.add("remove-row"),t.innerText="-";let n=t.closest(".field").cloneNode(!0);t.classList.add("add-row"),t.classList.remove("remove-row"),t.innerText="+",e.after(n),funTransitionHeight(s,trs_time)}else t.classList.contains("remove-row")&&(t.closest(".field").outerHTML="",funTransitionHeight(s,trs_time))});