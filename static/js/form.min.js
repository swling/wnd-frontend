function _wnd_render_form(t,e,a=""){function i(t){return`\n        <form v-bind="form.attrs">\n        <div v-if="form.before_html" v-html="form.before_html"></div>\n        <div class="field" v-show="form.title.title"><h3 v-bind="form.title.attrs" v-html="form.title.title"></h3></div>\n        <div v-bind="form.message.attrs" class="message" v-show="form.message.message"><div class="message-body" v-html="form.message.message"></div></div>\n        ${s(t)}\n        <div v-if="form.submit.text" class="field is-grouped is-grouped-centered">\n        <button type="button" v-bind="form.submit.attrs" @click="submit($event)" v-text="form.submit.text"></button>\n        </div>\n        <div class="form-script"></div>\n        <div v-if="form.after_html" v-html="form.after_html"></div>\n        </form>`}function s(t){let e="";for(let a=0;a<t.fields.length;a++){let i=t.fields[a],s=`form.fields[${a}]`;"html"==i.type?e+=i.value:general_input_fields.includes(i.type)?e+=n(s,a):"radio"==i.type||"checkbox"==i.type?e+=l(s,a):"hidden"==i.type?e+='<input v-bind="parse_input_attr('+s+')" v-model="'+s+'.value" />':"textarea"==i.type?e+=o(s,a):"editor"==i.type?e+=p(s,a):"image_upload"==i.type?e+=c(s,a):"file_upload"==i.type?e+=r(s,a):"select"==i.type?e+=d(s,a):"tag_input"==i.type&&(e+=f(s,a))}return e}function n(t,e){return`\n\t\t<div :class="get_field_class(${t})">\n\t\t<label v-if="${t}.label" class="label">{{${t}.label}}<span v-if="${t}.required" class="required">*</span></label>\n\t\t<div v-if="${t}.addon_left" class="control" v-html="${t}.addon_left"></div>\n\t\t<div :class="get_control_class(${t})">\n\t\t<input v-bind="parse_input_attr(${t})" v-model="${t}.value" @change="change(${t})" @keypress.enter="submit"/>\n\t\t<span v-if="${t}.icon_left" class="icon is-left"  v-html="${t}.icon_left"></span>\n\t\t<span v-if="${t}.icon_right"  class="icon is-right" v-html="${t}.icon_right"></span>\n\t\t</div>\n\t\t<div v-if="${t}.addon_right" class="control" v-html="${t}.addon_right"></div>\n\t\t<p v-if="!has_addon(${t})" v-show="${t}.help.text" class="help" :class="${t}.help.class">{{${t}.help.text}}</p>\n\t\t</div>`}function l(t,e){return`\n\t\t<div :class="get_field_class(${t})">\n\t\t<div :class="get_control_class(${t})">\n\t\t<template v-for="(radio_value, radio_label) in ${t}.options">\n\t\t<label :class="${t}.type">\n\t\t<input v-bind="parse_input_attr(${t})" :value="radio_value" v-model="${t}.checked" @click="change(${t})">\n\t\t{{radio_label}}</label>\n\t\t</template>\n\t\t</div>\n\t\t<p v-show="${t}.help.text" class="help" :class="${t}.help.class">{{${t}.help.text}}</p>\n\t\t</div>`}function d(t,e){return`\n\t\t<div class="field">\n\t\t<label v-if="${t}.label" class="label">{{${t}.label}}<span v-if="${t}.required" class="required">*</span></label>\n\t\t<div class="control">\n\t\t<div class="select" :class="${t}.class" @change="change(${t})">\n\t\t<select v-bind="parse_input_attr(${t})" v-model="${t}.selected">\n\t\t<template v-for="(value, name) in ${t}.options">\n\t\t<option :value="value">{{name}}</option>\n\t\t</template>\n\t\t</select>\n\t\t</div>\n\t\t</div>\n\t\t<p v-show="${t}.help.text" class="help" :class="${t}.help.class">{{${t}.help.text}}</p>\n\t\t</div>`}function o(t,e){return`\n\t\t<div :class="get_field_class(${t})">\n\t\t<label v-if="${t}.label" class="label">{{${t}.label}}<span v-if="${t}.required" class="required">*</span></label>\n\t\t<textarea v-model="${t}.value" v-bind="parse_input_attr(${t})" @change="change(${t})"></textarea>\n\t\t<p v-show="${t}.help.text" class="help" :class="${t}.help.class">{{${t}.help.text}}</p>\n\t\t</div>`}function r(t,e){return`\n\t\t<div :id="get_field_id(${t},${e})" class="field" :class="${t}.class">\n\t\t<div class="field"><div class="ajax-message"></div></div>\n\t\t<div class="columns is-mobile is-vcentered">\n\n\t\t<div class="column">\n\t\t<div class="file has-name is-fullwidth">\n\t\t<label class="file-label">\n\t\t<input type="file" class="file file-input" :name="${t}.name" @change="upload($event,${t})">\n\t\t<span class="file-cta">\n\t\t<span class="file-icon"><i class="fa fa-upload"></i></span>\n\t\t<span class="file-label">{{${t}.label}}</span>\n\t\t</span>\n\t\t<span class="file-name" v-html="${t}.file_name"></span>\n\t\t</label>\n\t\t</div>\n\t\t</div>\n\n\t\t<div v-show="${t}.delete_button && ${t}.file_id" class="column is-narrow">\n\t\t<a class="delete" @click="delete_file(${t},${e})"></a>\n\t\t</div>\n\n\t\t</div>\n\t\t</div>`}function c(t,e){return`\n\t\t<div :id="get_field_id(${t},${e})" class="field" :class="${t}.class">\n\t\t<div v-if="${t}.complete">\n\t\t<progress class="progress is-primary" :value="${t}.complete" max="100"></progress>\n\t\t</div>\n\n\t\t<label class="label">{{${t}.label}}<span v-if="${t}.required && ${t}.label" class="required">*</span></label>\n\t\t<a @click="click_target('#' + get_field_id(${t}, ${e}) + ' input[type=file]')">\n\t\t<img class="thumbnail" :src="${t}.thumbnail" :height="${t}.thumbnail_size.height" :width="${t}.thumbnail_size.width">\n\t\t</a>\n\t\t<a v-show="${t}.delete_button && ${t}.file_id" class="delete" @click="delete_file(${t}, ${e})"></a>\n\t\t<p v-show="${t}.help.text" class="help" :class="${t}.help.class">{{${t}.help.text}}</p>\n\t\t<div class="file"><input type="file" class="file file-input" accept="image/*" :name="${t}.name" @change="upload($event,${t})"></div>\n\t\t</div>`}function p(t,e){return`\n\t\t<div :class="get_field_class(${t})">\n\t\t<div :id="form.attrs.id + '-${e}'" class="rich-editor"></div>\n\t\t<label v-if="${t}.label" class="label">{{${t}.label}}<span v-if="${t}.required" class="required">*</span></label>\n\t\t<textarea style="display:none" v-model="${t}.value" v-bind="parse_input_attr(${t})" @change="change(${t})"></textarea>\n\t\t<p v-show="${t}.help.text" class="help" :class="${t}.help.class">{{${t}.help.text}}</p>\n\t\t</div>`}function f(t,e){let a=document.createElement("style");a.type="text/css",a.innerHTML="\n        .tags-input{width:100%;border-bottom:1px solid #ccc}\n        .tags-input input{border:none;width:100%;font-size:1rem;padding-top:0!important;padding-bottom:0!important}\n        .tags-input input:focus{border:none;box-shadow:none;outline:0;padding-top:0!important;padding-bottom:0!important}\n        .tags-input .tag{margin:5px}\n        .tags-input .autocomplete{position:relative;display:inline-block}\n        .tags-input .autocomplete-items{position:absolute;box-shadow:0 2px 10px #999;border-bottom:none;border-top:none;z-index:99;top:100%;left:0}\n        .tags-input .autocomplete-items li{padding:10px;cursor:pointer;background-color:#fff;border-bottom:1px solid #eee}\n        .tags-input .autocomplete-items li:hover{background-color:#eee}",document.head.appendChild(a);let i=`\n\t\t<template v-for="(tag, index) in ${t}.tags">\n\t\t<span class="tag is-medium is-light is-danger">{{tag}}<span class="delete" @click="delete_tag(tag, ${e})"></span></span>\n\t\t</template>`,s=`\n\t\t<template v-for="(tag, index) in ${t}.suggestions">\n\t\t<li @click="enter_tag_by_sg($event, ${e})">{{tag}}</li>\n\t\t</template>`;return`\n\t\t<div :class="get_field_class(${t})">\n\t\t<label v-if="${t}.label" class="label">{{${t}.label}}<span v-if="${t}.required" class="required">*</span></label>\n\t\t<div class="tags-input columns is-marginless">\n\t\t<div class="column is-marginless is-paddingless is-narrow">${i}</div>\n\t\t<div class="autocomplete column is-marginless">\n\t\t<input type="text" :readonly="${t}.tags.length >= max_tag_num" @input="suggest_tags($event.target.value, ${e})" @keypress.enter="enter_tag($event, ${e})" @click="handle_tag_input_click($event, ${e})"/>\n\t\t<input type="hidden" v-bind="parse_input_attr(${t})" v-model="${t}.tags" />\n\t\t<ul v-show="${t}.tags.length < max_tag_num" class="autocomplete-items">${s}</ul>\n\t\t</div>\n\t\t</div>\n\t\t<p v-show="${t}.help.text" class="help" :class="${t}.help.class">{{${t}.help.text}}</p>\n\t\t</div>`}let u=JSON.parse(JSON.stringify(e)),m=document.querySelector(t);a&&m.classList.add(a),wnd_inner_html(m,'<div class="vue-app"></div>'),new Vue({el:t+" .vue-app",template:i(u),data:{form:u,index:{editor:"",captcha:""}},methods:{has_addon:function(t){return t.addon_left||t.addon_right},has_icon:function(t){return t.icon_left||t.icon_right},get_field_class:function(t){return this.has_addon(t)?"field has-addons":"field"},get_control_class:function(t){let e="control";return e+=this.has_addon(t)?" is-expanded":"",e+=t.icon_left?" has-icons-left":"",e+=t.icon_right?" has-icons-right":"",e},get_field_id:function(t,e){return t.id||this.form.attrs.id+"-"+e},parse_input_attr:function(t){let e=JSON.parse(JSON.stringify(t));return Object.keys(e).forEach(t=>{e[t]&&""!=e[t]||delete e[t]}),e.class=(general_input_fields.includes(t.type)?"input":t.type)+" "+(e.class||""),delete e.icon_left,delete e.icon_right,delete e.addon_left,delete e.addon_right,delete e.options,delete e.label,delete e.help,delete e.value,delete e.field,"file_upload"==e.type&&(e.type="file"),delete e.data,e},build_editor:function(){function t(){field=e.form.fields[e.index.editor];const t=new wangEditor(`#${e.form.attrs.id}-${e.index.editor}`);t.config.uploadImgHeaders={"X-WP-Nonce":wnd.rest_nonce},t.config.uploadImgServer=wnd_action_api+"/wnd_upload_file_editor",t.config.uploadFileName="wnd_file[]",t.config.uploadImgParams={type:"wangeditor",post_parent:e.form.attrs["data-post-id"]||0,_ajax_nonce:field._ajax_nonce},t.config.showLinkImg=!1,t.config.onchange=(t=>{field.value=t}),t.config.excludeMenus=["fontSize","fontName","indent","todo","lineHeight","emoticon","video"],t.config.zIndex=9,t.create(),t.txt.html(field.value),e.$nextTick(function(){funTransitionHeight(m,trs_time)})}let e=this;if("undefined"==typeof wangEditor){let e=static_path+"editor/wangEditor.min.js?ver="+wnd.ver;wnd_load_script(e,function(){t()})}else t()},click_target(t){document.querySelector(t).click()},change:function(t){t.class=t.class.replace("is-danger",""),t.help.class=t.help.class.replace("is-danger",""),t.help.text=t.help.text.replace(" "+wnd.msg.required,""),this.$nextTick(function(){funTransitionHeight(m,trs_time)})},upload:function(t,e){let a=t.target.files,i=new FormData;if(e.data)for(const t in e.data)i.append(t,e.data[t]);for(let t=0,e=a.length;t<e;t++)i.set("wnd_file["+t+"]",a[t]);i.set("_ajax_nonce",e.data.upload_nonce),axios({url:wnd_action_api+"/wnd_upload_file",method:"post",data:i,headers:{},onUploadProgress:function(t){e.complete=t.loaded/t.total*100|0}}).then(t=>{if(t.data.status<=0)return e.help.text=t.data.msg,e.help.class="is-danger",!1;for(let a=0,i=t.data.length;a<i;a++)e.thumbnail=t.data[a].data.thumbnail,e.file_id=t.data[a].data.id,e.file_name=wnd.msg.upload_successfully+'&nbsp<a href="'+t.data[a].data.url+'" target="_blank">'+wnd.msg.view+"</a>",this.form.message.message=wnd.msg.upload_successfully,"image_upload"==e.type||"file_upload"==e.type||e.type;this.$nextTick(function(){funTransitionHeight(m,trs_time)})}).catch(t=>{console.log(t)})},delete_file:function(t,a){if(!t.file_id)return t.file_name="Error",!1;let i=new FormData;i.append("file_id",t.file_id),i.append("meta_key",t.data.meta_key),i.append("_ajax_nonce",t.data.delete_nonce),axios({url:wnd_action_api+"/wnd_delete_file",method:"post",data:i}).then(i=>{t.thumbnail=e.fields[a].default_thumbnail,t.file_name=wnd.msg.deleted,t.file_id=0,"image_upload"==t.type||"file_upload"==t.type||t.type}).catch(t=>{console.log(t)})},suggest_tags:function(t,e){let a={search:t,taxonomy:this.form.fields[e].taxonomy};axios({method:"get",url:wnd_jsonget_api+"/wnd_term_searcher",params:a}).then(t=>{this.form.fields[e].suggestions=t.data.data})},enter_tag:function(t,e){if(!t.target.value||this.form.fields[e].tags.length>=max_tag_num)return!1;this.form.fields[e].tags.push(t.target.value.trim()),t.target.value=""},enter_tag_by_sg:function(t,e){this.form.fields[e].tags.push(t.target.innerText.trim()),this.form.fields[e].suggestions="";let a=t.target.closest(".tags-input").querySelector("[type=text]");a.value=""},delete_tag:function(t,e){this.form.fields[e].tags=this.form.fields[e].tags.filter(function(e){return e!==t})},handle_tag_input_click:function(t,e){this.form.fields[e].tags.length>=max_tag_num&&(this.form.fields[e].help.text="最多"+max_tag_num+"个标签")},submit:function(t){if(this.form.submit.attrs.class=e.submit.attrs.class+" is-loading",this.index.captcha){let e=this.form.fields[this.index.captcha];if(!e.value)return void wnd_submit_via_captcha(t)}let a=!0;for(const[t,i]of this.form.fields.entries())!i.required||i.value||i.selected||i.checked||(i.class=e.fields[t].class+" is-danger",i.help.class=e.fields[t].help.class+" is-danger",i.help.text=e.fields[t].help.text+" "+wnd.msg.required,a=!1);if(!a)return this.form.submit.attrs.class=e.submit.attrs.class,this.$nextTick(function(){funTransitionHeight(m,trs_time)}),!1;let i=document.querySelector("#"+this.form.attrs.id),s=new FormData(i),n={};"get"==this.form.attrs.method.toLowerCase()&&(n=Object.fromEntries(s)),axios({method:this.form.attrs.method,url:this.form.attrs.action,data:s,params:n}).then(t=>{info=wnd_handle_response(t.data,this.form.attrs.route,m),this.form.message.message=info.msg,this.form.message.attrs.class=e.message.attrs.class+" "+info.msg_class,this.form.submit.attrs.class=e.submit.attrs.class,this.index.captcha&&Vue.set(this.form.fields[this.index.captcha],"value",""),this.$nextTick(function(){funTransitionHeight(m,trs_time)})}).catch(function(t){console.log(t)})}},mounted(){this.form.fields.forEach((t,e)=>{"captcha"==t.name&&""==t.value&&(this.index.captcha=e),"editor"==t.type&&(this.index.editor=e)}),this.index.editor&&this.build_editor(),funTransitionHeight(m,trs_time),wnd_inner_html(`#${this.form.attrs.id} .form-script`,this.form.script)},computed:{},watch:{}})}let general_input_fields=["text","number","email","password","url","color","date","range","tel"];var max_tag_num=void 0!==max_tag_num?max_tag_num:3;document.addEventListener("click",function(t){let e=t.target.closest("button");if(!e)return;let a=e.closest("form");if(!a)return;let i=a.parentNode;if(e.classList.contains("add-row")){let t=e.closest(".field");e.classList.remove("add-row"),e.classList.add("remove-row"),e.innerText="-";let a=e.closest(".field").cloneNode(!0);e.classList.add("add-row"),e.classList.remove("remove-row"),e.innerText="+",t.after(a),funTransitionHeight(i,trs_time)}else e.classList.contains("remove-row")&&(e.closest(".field").outerHTML="",funTransitionHeight(i,trs_time))});