const RichEditor={props:["modelValue","post_id","parent_node"],emits:["update:modelValue"],template:'<textarea id="rich-editor" class="is-hidden" v-model="modelValue"></textarea>',data:()=>({editor:null}),methods:{build_editor:function(e){const t=new ResizeObserver((e=>{funTransitionHeight(this.parent_node,trs_time)})),i=document.querySelector(e);i&&t.observe(i),tinymce.activeEditor&&tinymce.activeEditor.destroy(),tinymce.init({branding:!1,selector:e,menubar:!1,width:"100%",language:wnd.lang,cache_suffix:cache_suffix,autosave_restore_when_empty:!0,autosave_prefix:"tinymce-autosave-"+this.post_id,autosave_ask_before_unload:!1,relative_urls:!1,remove_script_host:!1,pagebreak_separator:"\x3c!--more--\x3e",pagebreak_split_block:!0,plugins:"advlist autolink autoresize autosave code codesample fullscreen image link lists pagebreak wordcount wndimage wndinit",toolbar:"styles | alignleft aligncenter alignright bullist numlist | blockquote wndimage link codesample  pagebreak wndpaidcontent | removeformat code fullscreen",wnd_config:{rest_nonce:wnd.rest_nonce,upload_url:wnd.rest_url+"action/common/wnd_upload_file",post_parent:this.post_id,oss_direct_upload:wnd.oss_direct_upload},setup:e=>{this.editor=e,texarea=i,texarea.style.removeProperty("display"),e.on("change",(()=>{this.parent_node.style.removeProperty("height"),this.$emit("update:modelValue",e.getContent())})),e.on("keyup",(()=>{this.$emit("update:modelValue",e.getContent())}))},init_instance_callback:e=>{t.observe(this.parent_node.querySelector(".tox-tinymce"))}})}},watch:{modelValue:function(e){this.editor&&this.editor.getContent()!==e&&this.editor.setContent(e)}},mounted:async function(){if("undefined"==typeof tinymce){let e=static_path+"editor/tinymce/tinymce.min.js"+cache_suffix;await wnd_load_script(e)}this.build_editor("#rich-editor")}},DropdownSearch={name:"DropdownSearch",props:{options:{type:Array,required:!0},modelValue:{type:[String,Number],default:null},required:{type:Boolean,default:!1}},emits:["update:modelValue","select"],data:()=>({search:"",isOpen:!1,activeIndex:-1,selectedOption:null}),computed:{filteredOptions(){return this.options.filter((e=>e.name.toLowerCase().includes(this.search.toLowerCase())))},maybe_required(){return!!this.required&&this.options.length>0}},mounted(){this.injectStyles(),this.updateSelection()},methods:{updateSelection(){if(null!=this.modelValue){const e=this.options.find((e=>e.value===this.modelValue));this.selectedOption=e||null,this.search=e?e.name:""}else this.selectedOption=null,this.search=""},selectOption(e){this.search=e.name,this.selectedOption=e,this.isOpen=!1,this.$emit("select",e),this.$emit("update:modelValue",e.value)},handleKeydown(e){const t=this.filteredOptions;if(this.isOpen||"ArrowDown"!==e.key&&"ArrowUp"!==e.key)switch(e.key){case"ArrowDown":this.activeIndex=(this.activeIndex+1)%t.length;break;case"ArrowUp":this.activeIndex=(this.activeIndex-1+t.length)%t.length;break;case"Enter":e.preventDefault(),this.activeIndex>=0&&this.activeIndex<t.length&&this.selectOption(t[this.activeIndex]);break}else this.isOpen=!0},handleBlur(){this.$nextTick((()=>{this.search=this.selectedOption?.name||"",this.isOpen=!1}))},handleClickOnInput(e){this.isOpen=!0,this.selectedOption&&(this.search=""),this.$nextTick((()=>this.$refs.input.focus()))},injectStyles(){const e=document.createElement("style");e.textContent="\n                .dropdown-search .is-active-option {\n                    cursor: pointer;\n                    background-color: #F0F0F0;\n                    transition: background-color 0.05s;\n                }",document.head.appendChild(e)}},watch:{modelValue:{immediate:!0,handler(e){this.updateSelection()}},options:{immediate:!0,handler(){this.updateSelection()}}},template:'\n<div class="dropdown dropdown-search is-active column is-paddingless">\n  <div class="dropdown-trigger" style="width: 100%;">\n    <input\n      ref="input"\n      :class="[{\'selected\': selectedOption }, \'input\']"\n      type="text"\n      placeholder="..."\n      v-model="search"\n      :disabled="options.length < 1"\n      @mousedown="handleClickOnInput"\n      @input="isOpen = true"\n      @keydown="handleKeydown"\n      @blur="handleBlur"\n      :required="maybe_required"\n    />\n  </div>\n  <div class="dropdown-menu" v-show="isOpen" style="width: 100%;">\n    <div class="dropdown-content" style="overflow-y:auto;max-height:300px;z-index:99">\n      <a\n        v-for="(opt, index) in filteredOptions"\n        :key="opt.value"\n        class="dropdown-item"\n        :class="[{\'is-active-option\': index === activeIndex }, {\'is-selected-option\': modelValue === opt.value}]"\n        @mousedown.prevent="selectOption(opt)"\n      >\n      {{ opt.name }}\n      </a>\n    </div>\n  </div>\n</div>\n    '},MultiLevelDropdown={components:{DropdownSearch:DropdownSearch},props:{options:Array,modelValue:Array,required:Boolean},data(){return{selectedValues:[...this.modelValue],currentOptionsList:[]}},watch:{modelValue:{immediate:!0,handler(e){const t=JSON.stringify(e)===JSON.stringify(this.selectedValues);Array.isArray(e)&&!t&&this.initializeFromModelValue(e)}}},methods:{initializeFromModelValue(e){this.selectedValues=[],this.currentOptionsList=[];let t=this.options;for(const i of e){this.currentOptionsList.push(t);const e=t.find((e=>e.value===i));if(!e)break;this.selectedValues.push(e.value),t=e.children||[]}t?.length&&this.currentOptionsList.push(t)},handleSelect(e,t){this.selectedValues.splice(e),this.selectedValues[e]=t.value,this.currentOptionsList.splice(e+1),t.children?.length&&this.currentOptionsList.push(t.children),this.$emit("update:modelValue",[...this.selectedValues])}},mounted(){this.initializeFromModelValue(this.modelValue)},template:'\n  <div class="dropdown-container columns is-gapless" style="width:100%">\n    <dropdown-search\n      v-for="(opts, index) in currentOptionsList"\n      :key="index"\n      :options="opts"\n      :model-value="selectedValues[index] ?? null"\n      @update:modelValue="val => selectedValues[index] = val"\n      @select="opt => handleSelect(index, opt)"\n      :required="required"\n    />\n  </div>\n'},TagsInput={props:{options:Array,maxTags:{type:Number,default:1/0},modelValue:{type:Array,default:()=>[]},required:{type:Boolean,default:!1}},emits:["update:modelValue"],data:()=>({input:"",selectedIndex:-1,selectedTags:[],filteredOptions:[],pendingDeleteIndex:null}),mounted(){this.selectedTags=this.mapModelValueToTags(this.modelValue),this.filterOptions(),this.injectStyles()},watch:{input(){this.filterOptions(),this.pendingDeleteIndex=null},modelValue(e){this.selectedTags=this.mapModelValueToTags(e),this.filterOptions()}},methods:{mapModelValueToTags(e){return e.map((e=>this.options.find((t=>t.value===e))||{name:e,value:e}))},filterOptions(){const e=this.input.toLowerCase(),t=this.selectedTags.map((e=>e.value));this.filteredOptions=this.options.filter((i=>i.name.toLowerCase().includes(e)&&!t.includes(i.value))),this.selectedIndex=-1},addTag(e){this.selectedTags.length>=this.maxTags||this.selectedTags.some((t=>t.value===e.value))||(this.selectedTags.push(e),this.input="",this.pendingDeleteIndex=null,this.$emit("update:modelValue",this.selectedTags.map((e=>e.value))))},addFromInput(){const e=this.input.trim();if(!e)return;const t=this.options.find((t=>t.name.toLowerCase()===e.toLowerCase()))||{name:e,value:e};this.addTag(t)},removeTag(e){e>=0&&(this.selectedTags.splice(e,1),this.pendingDeleteIndex=null,this.$emit("update:modelValue",this.selectedTags.map((e=>e.value))))},handleKeydown(e){const t=this.filteredOptions.length;if("ArrowDown"===e.key)t>0&&(this.selectedIndex=(this.selectedIndex+1)%t);else if("ArrowUp"===e.key)t>0&&(this.selectedIndex=(this.selectedIndex-1+t)%t);else if("Enter"===e.key){e.preventDefault();if(!this.input.trim())return;const t=this.filteredOptions[this.selectedIndex];t?this.addTag(t):this.addFromInput()}else"Backspace"===e.key&&""===this.input&&(this.pendingDeleteIndex===this.selectedTags.length-1?this.removeTag(this.pendingDeleteIndex):this.selectedTags.length>0&&(this.pendingDeleteIndex=this.selectedTags.length-1))},onFocus(){this.filterOptions()},handleBlur(){this.filteredOptions=[],this.selectedIndex=-1,this.pendingDeleteIndex=null},isPendingDelete(e){return e===this.pendingDeleteIndex},injectStyles(){const e=document.createElement("style");e.textContent="\n.tags-input {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: 0.5em;\n  border-bottom: 1px solid #dbdbdb;\n  padding: 0.5em 0 0 0;\n  min-height: 2.5em;\n}\n.tags-input input.input {\n  border: none;\n  box-shadow: none;\n  flex: 1;\n  min-width: 120px;\n  padding: 0.25em 0.5em;\n}\n.tags-input input.input:focus {\n  outline: none;\n  box-shadow: none;\n}\n.tags-input .tag {\n  margin-bottom: 0;\n  display: flex;\n  align-items: center;\n}\n.tags-input-warp .dropdown-item:hover, .tags-input-warp .dropdown-item.is-active {\n  cursor: pointer;\n  transition: background-color 0.05s;\n  background-color: #f0f0f0;\n}\n      ",document.head.appendChild(e)}},template:'\n<div class="tags-input-warp field dropdown is-active" style="width:100%">\n  <div class="control tags-input" style="width:100%">\n    <span\n      v-for="(tag, index) in selectedTags"\n      :key="tag.value"\n      class="tag"\n      :class="[\'is-medium\', isPendingDelete(index) ? \'is-danger\' : \'is-danger is-light\']"\n    >\n      {{ tag.name }}\n      <a class="delete is-small" @click="removeTag(index)"></a>\n    </span>\n    <input\n      class="input"\n      type="text"\n      v-model="input"\n      @keydown="handleKeydown"\n      :placeholder="selectedTags.length >= maxTags ? \'Maximum reached\' : \'Add a tag...\'"\n      :disabled="selectedTags.length >= maxTags"\n      @focus="onFocus"\n      @blur="handleBlur"\n      :required="required"\n    />\n  </div>\n  <div v-show="filteredOptions.length && input && selectedTags.length < maxTags" class="dropdown-menu" style="width: 100%;">\n    <ul class="dropdown-content is-marginless">\n      <li\n        v-for="(option, index) in filteredOptions"\n        :key="option.value"\n        :class="[\'dropdown-item\', { \'is-active\': index === selectedIndex }]"\n        @mousedown.prevent="addTag(option)"\n      >\n        {{ option.name }}\n      </li>\n    </ul>\n  </div>\n</div>\n  '},ThumbnailCard={props:{imgWidth:{type:Number,default:100},imgHeight:{type:Number,default:100},cropWidth:{type:Number,default:300},cropHeight:{type:Number,default:300},meta_key:{type:String,default:""},post_parent:{type:Number,default:0},thumbnail:{type:String,default:""}},data:()=>({imageDataUrl:"",tempImageUrl:"",cropper:null,showModal:!1}),mounted(){this.injectStyles()},methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFileChange(e){const t=e.target.files[0];if(t&&t.type.startsWith("image/")){const e=new FileReader;e.onload=async e=>{"undefined"==typeof Cropper&&(await wnd_load_script(static_path+"cropper/cropper.min.js"+cache_suffix),await wnd_load_style(static_path+"cropper/cropper.min.css"+cache_suffix)),this.tempImageUrl=e.target.result,this.showModal=!0,this.$nextTick((()=>{const e=this.$refs.cropImage;this.cropper=new Cropper(e,{aspectRatio:this.imgWidth/this.imgHeight,viewMode:1,autoCropArea:1})}))},e.readAsDataURL(t)}},applyCrop(){if(this.cropper){const e=this.cropper.getCroppedCanvas({width:this.cropWidth,height:this.cropHeight});e.toBlob((t=>{this.uploadCroppedImage(t,e)}),"image/webp"),this.cropper.destroy(),this.cropper=null,this.showModal=!1}},cancelCrop(){this.cropper&&(this.cropper.destroy(),this.cropper=null),this.showModal=!1},async uploadCroppedImage(e,t){try{if(wnd.oss_direct_upload){let t=await this.upload_to_oss(e);t.id?this.imageDataUrl=URL.createObjectURL(e):alert("Upload failed : "+t.msg)}else{let t=await this.upload_to_local_server(e);t.status>0?this.imageDataUrl=URL.createObjectURL(e):alert(t.msg)}}catch(e){alert("Upload failed.")}},async upload_to_local_server(e){const t=new FormData;return t.append("wnd_file",e,"CroppedImage.webp"),t.append("meta_key",this.meta_key),t.append("post_parent",this.post_parent),await wnd_ajax_action("common/wnd_upload_file",t)},async upload_to_oss(e){let t=new File([e],"oss_file.webp",{type:"image/webp"});return await wnd_upload_to_oss(t,{meta_key:this.meta_key,post_parent:this.post_parent})},injectStyles(){const e=document.createElement("style");e.textContent="\n.thumbnail-img {\n    object-fit: cover;\n    display: block;\n    cursor: pointer;\n}\n.thumbnail-img:hover {\n    border-color: #3273dc;\n}\n.thumbnail-drop-area {\n    border: 1px dashed #dbdbdb;\n    border-radius: 4px;\n    position: relative;\n    cursor: pointer;\n}\n.cropper-container {\n    max-height: 600px;\n    max-width: 800px;\n    overflow: hidden;\n}\n      ",document.head.appendChild(e)}},computed:{thumbnail_url(){return this.imageDataUrl||this.thumbnail}},template:'\n<div class="thumbnail-card" style="width: 100%;">\n      <div class="thumbnail-drop-area" :style="{ width: imgWidth + \'px\', height: imgHeight + \'px\' }" @click="triggerFileInput">\n        <img v-if="thumbnail_url" :src="thumbnail_url" class="thumbnail-img" :width="imgWidth" :height="imgHeight"/>\n        <input type="file" ref="fileInput" accept="image/*" @change="handleFileChange" style="display: none">\n      </div>\n  </div>\n  <div class="modal" :class="{ \'is-active\': showModal }">\n    <div class="modal-background" @click="cancelCrop"></div>\n    <div class="modal-card" style="width: auto; max-width: 90%;">\n      <section class="modal-card-body has-text-centered">\n        <i>双击裁剪 / Double-click to crop</i>\n        <div class="cropper-container" @dblclick="applyCrop">\n          <img :src="tempImageUrl" ref="cropImage" style="max-width: 100%;"/>\n        </div>\n      </section>\n    </div>\n  </div>\n</div>\n    '},FileUploader={props:{post_parent:{type:Number,default:0},meta_key:{type:String,default:0},file_id:{type:Number,default:0},file_url:{type:String,default:""},is_private:{type:Boolean,default:!1}},data(){return{current_file_id:this.file_id,current_file_url:this.file_url}},watch:{file_id(e){this.current_file_id=e},file_url(e){this.current_file_url=e}},methods:{async handleFileChange(e){this.current_file_id=0,this.current_file_url="";const t=e.target.files[0];try{if(wnd.oss_direct_upload){let e=await this.upload_to_oss(t);e.id?(this.current_file_id=e.id,this.current_file_url=e.url):alert("Upload failed : "+e.msg)}else{let e=await this.upload_to_local_server(t);e.status>0?(this.current_file_id=e.data.id,this.current_file_url=e.data.url):alert(e.msg)}}catch(e){alert("Upload failed.")}},async upload_to_local_server(e){const t=new FormData;return t.append("wnd_file",e),t.append("meta_key",this.meta_key),t.append("post_parent",this.post_parent),t.append("is_private",this.is_private),await wnd_ajax_action("common/wnd_upload_file",t)},async upload_to_oss(e){return await wnd_upload_to_oss(e,{meta_key:this.meta_key,post_parent:this.post_parent,is_private:this.is_private})},delete_file:async function(){data={file_id:this.current_file_id,meta_key:this.meta_key,post_parent:this.post_parent};let e=await wnd_ajax_action("common/wnd_delete_file",data);e.status>0?(this.current_file_id=0,this.current_file_url=""):alert(e.msg)}},template:'\n<div class="file has-name is-fullwidth is-normal">\n\t<div class="file-label" style="cursor: default;">\n\t\t<input type="file" id="paid-file-component" class="file file-input" @change="handleFileChange"/>\n\t\t<label class="file-cta is-clickable" for="paid-file-component">\n            <span class="file-icon"><i class="fa fa-upload"></i></span>\n        </label>\n\t\t<span class="file-name">\n\t\t\t<a v-if="current_file_url" :href="current_file_url" target="_blank">\n\t\t\t\t<i class="fas fa-download"></i> ……\n\t\t\t</a>\n\t\t\t<span v-else>……</span>\n            <span v-show="current_file_id" class="is-pulled-right">\n                <a class="delete is-medium" @click="delete_file()" title="Delete"></a>\n            </span>\n\t\t</span>\n\t</div>\n</div>\n    '},PostPriceInput={props:{post_parent:{type:Number,default:0},modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],methods:{set_sku(){wnd_ajax_modal("common/wnd_sku_form",{post_id:this.post_parent})}},template:'\n<div class="field has-addons">\n\t<div class="control is-expanded has-icons-left">\n\t\t<input \n            placeholder="price" \n            min="0" \n            step="0.01" \n            type="number" \n            class="input" \n            :value="modelValue" \n            @input="$emit(\'update:modelValue\', $event.target.value)" \n        />\n\t\t<span class="icon is-left"><i class="fas fa-dollar-sign"></i></span>\n\t</div>\n\t<div class="control">\n\t\t<a class="button" @click="set_sku">SKU</a>\n\t</div>\n</div>\n    '},PaidContent={props:{post_parent:{type:Number,default:0},price:{type:Number,default:0},file_id:{type:Number,default:0},file_url:{type:String,default:""}},emits:["update:price"],components:{PostPriceInput:PostPriceInput,FileUploader:FileUploader},methods:{set_sku(){wnd_ajax_modal("common/wnd_sku_form",{post_id:this.post_parent})}},template:'\n<div class="field is-horizontal">\n\t<div class="field-label is-normal">\n\t\t<label class="label is-hidden-mobile"><i class="fas fa-file-invoice-dollar"></i></label>\n\t</div>\n\t<div class="field-body is-block">\n\t\t<div class="columns">\n\t\t\t<div class="column">\n            <post-price-input :post_parent="post_parent" v-model="price" @update:modelValue="$emit(\'update:price\', $event)"></post-price-input>\n\t\t\t</div>\n\t\t\t<div class="column upload-field">\n\t\t\t\t<file-uploader :post_parent="post_parent" meta_key="file" :file_id="file_id" :file_url="file_url" is_private="1"></file-uploader>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n    '};class FormComponent{parent_node=null;template="";constructor(e){this.parent_node=document.querySelector(e).parentNode}data(){}toVueComponent(){const e=this;return{template:this.template,data:()=>e.data(),methods:e.methods(),watch:e.watch(),computed:e.computed(),components:e.components(),created(){e.created.call(this)},mounted(){e.mounted.call(this)},updated(){e.updated.call(this)},beforeUnmount(){e.beforeUnmount.call(this)}}}methods(){const e={},t=new Set,i=new Set(["constructor","data","methods","watch","components","template","created","mounted","updated","beforeMount","beforeUpdate",,"beforeUnmount","unmounted","toVueComponent","unmount"]);let n=Object.getPrototypeOf(this);for(;n&&n!==Object.prototype;){const s=Object.getOwnPropertyNames(n);for(const a of s){if(t.has(a))continue;if(i.has(a))continue;const s=Object.getOwnPropertyDescriptor(n,a);"function"==typeof s.value&&(t.add(a),e[a]=function(...e){return s.value.apply(this,e)})}n=Object.getPrototypeOf(n)}return e}created(){}mounted(){this.get_data(),document.addEventListener("keydown",this.onKeydown),window.addEventListener("hashchange",this.get_data)}beforeUnmount(){document.removeEventListener("keydown",this.onKeydown),window.removeEventListener("hashchange",this.get_data)}components(){return{ThumbnailCard:ThumbnailCard,RichEditor:RichEditor,DropdownSearch:DropdownSearch,MultiLevelDropdown:MultiLevelDropdown,TagsInput:TagsInput,FileUploader:FileUploader,PostPriceInput:PostPriceInput,PaidContent:PaidContent}}watch(){}computed(){}updated(){funTransitionHeight(this.parent_node,trs_time)}handle_submit(){const e=this.$refs.formRef.querySelectorAll("[required]");let t=!0;e.forEach((e=>{e.value.trim()||(t=!1)})),t&&this.submit_data()}onKeydown(e){(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),this.handle_submit())}addPrefixToKeys(e,t){return Object.fromEntries(Object.entries(e).map((([e,i])=>[`${t}${e}`,i])))}resizeTextarea(e){e.target.style["overflow-y"]="hidden",e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"}async get_data(){}async submit_data(){}}class PostFormComponent extends FormComponent{action="post/wnd_insert_post";data(){return{res:{},post:{},meta:{},thumbnail:"",file_id:0,file_url:"",parent_node:this.parent_node,action:this.action,loading:!0,submitting:!1,submit_res:{},has_error:!1,link:"",msg:"",wnd:wnd}}async get_data(){const e=window.location.hash.slice(1),t=new URLSearchParams(e),i={};for(const[e,n]of t.entries())"module"!==e&&(i[e]=n);this.loading=!0;let n=await wnd_query("wnd_get_post_edit",i);if(this.res=n,this.loading=!1,n.status<=0)return this.has_error=!0,void(this.msg=n.msg);this.has_error=!1,this.init_data(n.data)}init_data(e){this.post=Vue.reactive(e.post),this.meta=Vue.reactive(e.meta),this.post.post_title="Auto-draft"===this.post.post_title?"":this.post.post_title,this.thumbnail=e.thumbnail,this.file_id=e.file_id,this.file_url=e.file_url}async submit_data(){let e=this.get_meta_data(),t=this.get_term_data(),i=this.addPrefixToKeys(this.post,"_post_"),n=this.get_extra_data();delete i._post_post_status;let s={...e,...t,...i,...n};this.submitting=!0;let a=await wnd_ajax_action(this.action,s);if(this.submitting=!1,a.status<=0)return this.has_error=!0,void(this.msg=a.msg);this.has_error=!1,this.msg=a.msg,this.link=a.data.url,this.submit_res=a}get_meta_data(){}get_term_data(){}get_extra_data(){}processTagOptions(e,t){return{options:e.map((e=>({name:e.name,value:e.slug}))),selected:t?t.map((e=>e.slug)):[]}}processCatOptions(e,t){const i=[];const n=function e(n){return n.map((n=>{const s={name:n.name,value:n.term_id};return t&&t.some((e=>e.term_id===n.term_id))&&i.push(n.term_id),n.children&&n.children.length>0&&(s.children=e(n.children)),s}))}(e);return{options:n,selected:i.length>0?i:[]}}onKeydown(e){super.onKeydown(e),"F8"===e.key&&(e.preventDefault(),this.submit_res={},this.link="",this.msg="",this.get_data())}}function _wnd_render_form(e,t,i="",n){let s=["text","number","email","password","url","color","date","range","tel"],a=JSON.parse(JSON.stringify(t)),l=document.querySelector(e);i&&l.classList.add(i);let o={template:function e(t){let i=e;function n(){return`\n<form v-bind="form.attrs">\n<div v-if="form.before_html" v-html="form.before_html"></div>\n<div class="field" v-show="form.title.title"><h3 v-bind="form.title.attrs" v-html="form.title.title"></h3></div>\n<div v-bind="form.message.attrs" class="notification is-light" v-show="form.message.message" v-html="form.message.message"></div>\n${function(e){let t="";for(let a=0;a<e.fields.length;a++){let l=e.fields[a],o=`form.fields[${a}]`;if(n()&&(t+=`\n<div class="field is-horizontal">\n<div class="field-label ${e.size}">\n<label v-if="${o}.label" class="label is-hidden-mobile"><span v-if="${o}.required" class="required">*</span>{{${o}.label}}</label>\n</div>\n<div class="field-body">`),"html"==l.type)t+=l.value;else if(s.includes(l.type))t+=i.build_text(o,a);else if("radio"==l.type||"checkbox"==l.type)t+=i.build_radio(o,a);else if("hidden"==l.type)t+='<input v-bind="parse_input_attr('+o+')" v-model="'+o+'.value" />';else{let e="build_"+l.type;t+=i[e](o,a)}function n(){return e.attrs["is-horizontal"]&&!["html","hidden"].includes(l.type)}n()&&(t+="</div></div>")}return t}(t)}\n${function(e){return`\n<div v-if="form.submit.text" class="field has-text-centered">\n<button type="button" v-bind="form.submit.attrs" @click="submit($event)" class="${e.size}" v-text="form.submit.text"></button>\n</div>`}(t)}\n<div class="form-script"></div>\n<div v-if="form.after_html" v-html="form.after_html"></div>\n</form>`}return build_label=(e,t)=>`<label v-if="!form.attrs['is-horizontal'] && ${e}.label" class="label" :class="form.size"><span v-if="${e}.required" class="required">*</span>{{${e}.label}}</label>`,i.build_text=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<div v-if="${e}.addon_left" class="control" v-html="${e}.addon_left"></div>\n<div :class="get_control_class(${e})">\n<input v-bind="parse_input_attr(${e})" :value="html_decode(${e}.value)" @input="${e}.value=html_encode($event.target.value)" @change="change(${e}, $event)" @keypress.enter="submit"/>\n<span v-if="${e}.icon_left" class="icon is-left"  v-html="${e}.icon_left"></span>\n<span v-if="${e}.icon_right" class="icon is-right" v-html="${e}.icon_right"></span>\n</div>\n<div v-if="${e}.addon_right" class="control" v-html="${e}.addon_right"></div>\n<p v-if="!has_addon(${e})" v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,i.build_radio=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<div :class="get_control_class(${e})">\n<template v-for="(radio_value, radio_label) in ${e}.options">\n<label :class="${e}.type">\n<input v-bind="parse_input_attr(${e})" :value="radio_value" v-model="${e}.checked" @change="change(${e}, $event)" :disabled="should_be_disabled(${e}, radio_value)">\n{{radio_label}}</label>\n</template>\n</div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,i.build_select=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<div v-if="${e}.addon_left" class="control" v-html="${e}.addon_left"></div>\n<div :class="get_control_class(${e})">\n<div class="select" :class="${e}.class + ' ' + form.size">\n<select v-bind="parse_input_attr(${e})" v-model="${e}.selected" @change="change(${e}, $event)">\n<option disabled value="">- {{${e}.label}} -</option>\n<option v-for="(value, name) in ${e}.options" :value="value">{{name}}</option>\n</select>\n</div>\n<span v-if="${e}.icon_left" class="icon is-left"  v-html="${e}.icon_left"></span>\n<span v-if="${e}.icon_right" class="icon is-right" v-html="${e}.icon_right"></span>\n</div>\n<div v-if="${e}.addon_right" class="control" v-html="${e}.addon_right"></div>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,i.build_textarea=(e,t)=>`\n<div :class="get_field_class(${e})">\n${build_label(e)}\n<textarea :value="html_decode(${e}.value)" @input="${e}.value = html_encode($event.target.value)" v-bind="parse_input_attr(${e})" @change="change(${e}, $event)"></textarea>\n<p v-show="${e}.help.text" class="help" :class="${e}.help.class">{{${e}.help.text}}</p>\n</div>`,i.build_image_upload=(e,t)=>`\n<div :class="get_field_class(${e})">            \n<thumbnail-card \n:img-width="${e}.thumbnail_size.width" \n:img-height="${e}.thumbnail_size.height" \n:crop-width="${e}.data.save_width" \n:crop-height="${e}.data.save_height" \n:post_parent="${e}.data.post_parent" \n:meta_key="${e}.data.meta_key" \n:thumbnail="${e}.thumbnail">\n</thumbnail-card>\n</div>`,n()}(a),data:()=>({form:a,index:{captcha:"",ids:[]},default_data:{}}),components:{ThumbnailCard:ThumbnailCard},methods:{html_encode:function(e){let t=document.createElement("div");t.innerText=e;let i=t.innerHTML;return t=null,i},html_decode:function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.innerText;return t=null,i},has_addon:function(e){return e.addon_left||e.addon_right},has_icon:function(e){return e.icon_left||e.icon_right},get_field_class:function(e){return this.has_addon(e)?"field has-addons":"field"},get_control_class:function(e){let t="control";return t+=this.has_addon(e)?" is-expanded":"",t+=e.icon_left?" has-icons-left":"",t+=e.icon_right?" has-icons-right":"",t},get_field_id:function(e,t){return e.id||this.form.attrs.id+"-"+t},get_value:function(e){let t=["checkbox","radio"].includes(e.type)?[]:"",i=e.checked||e.selected;return e.value?t=e.value:i&&("object"!=typeof i||i.length||Object.keys(i).length)&&(t=e.checked||e.selected),t="object"==typeof t?Object.values(t):t,t},parse_input_attr:function(e,t=[]){let i=JSON.parse(JSON.stringify(e));return Object.keys(i).forEach((e=>{i[e]&&""!=i[e]||delete i[e]})),t.forEach((e=>{delete i[e]})),i.class=(s.includes(e.type)?"input":e.type)+" "+(i.class||""),i.class+=" "+this.form.size,delete i.icon_left,delete i.icon_right,delete i.addon_left,delete i.addon_right,delete i.options,delete i.label,delete i.help,delete i.value,delete i.checked,delete i.selected,delete i.options,"file_upload"==i.type?i.type="file":"select"!=i.type&&"select_linked"!=i.type||delete i.type,delete i.data,delete i.linkage,i},should_be_disabled:function(e,t){if("checkbox"==e.type&&e.max>0){let i=e.checked;if(i.length>=e.max&&!i.includes(t))return!0}return!1},change:async function(e,t){e.class=e.class.replace("is-danger",""),e.help.class=e.help.class.replace("is-danger",""),e.help.text=e.help.text.replace(" "+wnd.msg.required,"")},formdata_to_object:function(e){let t={};return e.forEach(((e,i)=>{i.includes("[]")?(i=i.replace("[]",""),Reflect.has(t,i)?t[i].push(e):t[i]=[e]):t[i]=e})),t},submit:function(e){if(this.form.submit.attrs.class=t.submit.attrs.class+" is-loading",this.index.captcha){if(!this.form.fields[this.index.captcha].value)return void wnd_submit_via_captcha(e)}let i=!0;for(const[e,n]of this.form.fields.entries()){if(!n.name||!n.required)continue;let s=!0,a=this.get_value(n);Object.values(n.options).includes(a)||("string"!=typeof a||a.length?Array.isArray(a)&&a.every((e=>!e))?s=!1:a||0===a||(s=!1):s=!1,s||(n.class=t.fields[e].class+" is-danger",n.help.class=t.fields[e].help.class+" is-danger",n.help.text=t.fields[e].help.text+" "+wnd.msg.required,i=!1))}if(!i)return this.form.submit.attrs.class=t.submit.attrs.class,!1;let n=document.querySelector("#"+this.form.attrs.id),s=new FormData(n),a=JSON.parse(JSON.stringify(this.default_data)),o=Object.assign(a,this.formdata_to_object(s)),d={};"get"==this.form.attrs.method.toLowerCase()&&(d=o),axios({method:this.form.attrs.method,url:this.form.attrs.action,data:o,params:d}).then((e=>{info=wnd_handle_response(e.data,this.form.attrs.route,l),this.form.message.message=!1===info.msg?this.form.message.message:info.msg,this.form.message.attrs.class=t.message.attrs.class+" "+info.msg_class,this.form.submit.attrs.class=t.submit.attrs.class,this.index.captcha&&(this.form.fields[this.index.captcha].value="")})).catch((function(e){}))},reload:async function(e){let t=await axios({method:"get",url:n});this.form=t.data.data.structure}},created(){for(let e=0,t=this.form.fields.length;e<t;e++){let t=this.form.fields[e];if("captcha"!=t.name||""!=t.value){if(t.name){let e=t.name.replace("[]","");this.default_data[e]=""}t.id&&(this.index.ids[t.id]=e)}else this.index.captcha=e}},mounted(){wnd_inner_html(`#${this.form.attrs.id} .form-script`,this.form.script),funTransitionHeight(l,trs_time)},updated(){funTransitionHeight(l,trs_time)}};Vue.createApp(o).mount(e)}