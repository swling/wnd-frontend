var $=jQuery.noConflict();function getCookie(c_name){return document.cookie.length>0&&(c_start=document.cookie.indexOf(c_name+"="),-1!=c_start)&&(c_start=c_start+c_name.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end)))}function setCookie(name,value,seconds,path="/"){if(!(seconds=seconds?1e3*seconds:0))return!1;var expires="",date=new Date;date.setTime(date.getTime()+seconds),expires="; expires="+date.toGMTString(),document.cookie=name+"="+escape(value)+expires+"; path="+path}function wnd_is_mobile(){return!!navigator.userAgent.match(/(iPhone|iPad|iPod|Android|ios|App\/)/i)}function wnd_is_spider(){var userAgent;return!!navigator.userAgent.match(/(Googlebot|Baiduspider|spider)/i)}var wait=90,send_countdown,ajax_alert_time_out,ajax_msg_time_out;function wnd_send_countdown(){wait>0?($(".send-code").text(wait+"秒"),wait--,send_countdown=setTimeout(wnd_send_countdown,1e3)):($(".send-code").text("获取验证码").attr("disabled",!1).fadeTo("slow",1),wait=90)}function wnd_alert_modal(html,is_gallery=!1){wnd_reset_modal(),is_gallery?$(".modal").addClass("is-active wnd-gallery"):($(".modal").addClass("is-active"),$(".modal-entry").addClass("box")),$(".modal-entry").html(html)}function wnd_alert_msg(msg,wait=0){wnd_reset_modal(),$(".modal").addClass("is-active"),$(".modal-entry").removeClass("box"),$(".modal-entry").html('<div class="alert-message content has-text-white has-text-centered">'+msg+"</div>"),wait>0&&(ajax_alert_time_out=setTimeout(function(){wnd_reset_modal()},1e3*wait))}function wnd_ajax_msg(msg,style="is-danger",parent="body",wait=0){$(parent+" .ajax-message:first").html('<div class="message '+style+'"><div class="message-body">'+msg+"</div></div>"),wait>0&&(ajax_msg_time_out=setTimeout(function(){$(parent+" .ajax-message:first").empty()},1e3*wait))}function wnd_reset_modal(){clearTimeout(ajax_msg_time_out),clearTimeout(ajax_alert_time_out),clearTimeout(send_countdown),$("#modal").length?($(".modal").removeClass("is-active wnd-gallery"),$(".modal-entry").removeClass("box"),$(".modal-entry").empty()):$("body").append('<div id="modal" class="modal"><div class="modal-background"></div><div class="modal-content"><div class="modal-entry"></div></div><button class="modal-close is-large" aria-label="close"></button></div>')}function wnd_click(target_element){$(target_element).trigger("click")}function wnd_confirm_form_submit(form_id,msg=""){wnd_alert_modal("<p>"+msg+'</p><div class="field is-grouped is-grouped-centered"><div class="control"><button class="button is-dark"  onclick="wnd_ajax_submit(\''+form_id+"')\" >确定</button></div></div>")}function wnd_ajax_modal(template,param=0){$.ajax({type:"POST",url:wnd.api_url,data:{action:template,param:param,ajax_type:"modal"},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wnd.api_nonce),wnd_alert_msg("……")},success:function(response){wnd_reset_modal(),"object"==typeof response?wnd_alert_msg(response.msg):wnd_alert_modal(response)},error:function(){wnd_alert_msg("系统错误！")}})}function wnd_ajax_embed(container,template,param=0){$.ajax({type:"POST",url:wnd.api_url,data:{action:template,param:param,ajax_type:"embed"},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wnd.api_nonce)},success:function(response){wnd_reset_modal(),"object"==typeof response?wnd_alert_msg(response.msg):$(container).html(response)},error:function(){wnd_alert_msg("系统错误！")}})}function wnd_ajax_submit(form_id){var submit_button=$("#"+form_id+" [type='submit']"),input_value=!0;$("#"+form_id+" input").each(function(){var required;"required"==$(this).attr("required")&&(""==$(this).val()&&(input_value=!1,$(this).addClass("is-danger")),"radio"!=$(this).attr("type")&&"checkbox"!=$(this).attr("type")||$("[name="+$(this).attr("name")+"]:checked").length<=0&&(input_value=!1,$(this).addClass("is-danger")))});var option_value=!0;$("#"+form_id+" select option:selected").each(function(){var required=$(this).parent().attr("required");if(option_value=$(this).val(),"required"==required&&"-1"==option_value)return option_value=!1,$("#"+form_id+" select").addClass("is-danger"),!1});var textarea_value=!0;if($("#"+form_id+" textarea").each(function(){var required;"required"==$(this).attr("required")&&""==$(this).val()&&(textarea_value=!1,$(this).addClass("is-danger"))}),!1===input_value||!1===option_value||!1===textarea_value)return wnd_ajax_msg('<span class="required">*</span>星标为必填项目！',"is-danger","#"+form_id),submit_button.text("必填项不能为空"),!1;if($(".wp-editor-area").length>0){var wp_editor_id=$(".wp-editor-area").attr("id"),content,editor=tinyMCE.get(wp_editor_id);content=editor?editor.getContent():$("#"+wp_editor_id).val(),$("#"+wp_editor_id).val(content)}var form_data=new FormData($("#"+form_id).get(0));$.ajax({url:wnd.api_url,dataType:"json",cache:!1,contentType:!1,processData:!1,data:form_data,type:"POST",beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wnd.api_nonce),submit_button.addClass("is-loading")},success:function(response){submit_button.removeClass("is-loading"),2!=response.status&&0!=response.status&&submit_button.attr("disabled","disabled");var submit_text=response.msg.length<=10?response.msg:response.status>0?"提交成功":"提交失败";submit_button.text(submit_text);var style=response.status>0?"is-success":"is-danger";switch(response.status){case 1:wnd_ajax_msg(response.msg,style,"#"+form_id);break;case 2:wnd_ajax_msg('提交成功！<a href="'+response.data.url+'" target="_blank">查看</a>',style,"#"+form_id);break;case 3:wnd_ajax_msg("请稍后……",style,"#"+form_id),$(window.location).attr("href",response.data.redirect_to);break;case 4:wnd_reset_modal(),window.location.reload(!0);break;case 5:wnd_alert_msg(response.msg,1);break;case 6:wnd_ajax_msg("下载中……",style,"#"+form_id,5),$(window.location).attr("href",response.data.redirect_to);break;default:wnd_ajax_msg(response.msg,style,"#"+form_id)}},error:function(){wnd_ajax_msg("系统错误！","is-danger","#"+form_id),submit_button.removeClass("is-loading"),submit_button.text("系统错误"),submit_button.attr("disabled","disabled")}})}function wnd_ajax_update_views(post_id,interval=3600){for(var timestamp=Date.parse(new Date)/1e3,wnd_views=localStorage.getItem("wnd_views")?JSON.parse(localStorage.getItem("wnd_views")):[],max_length=10,is_new=!0,i=0;i<wnd_views.length;i++)if(wnd_views[i].post_id==post_id){if(wnd_views[i].timestamp<timestamp-interval){wnd_views[i].timestamp=timestamp;var is_new=!0}else var is_new=!1;break}if(is_new){var new_view={post_id:post_id,timestamp:timestamp};wnd_views.unshift(new_view)}wnd_views.length>10&&(wnd_views.length=10),is_new&&$.ajax({type:"POST",datatype:"json",url:wnd.api_url,data:{param:post_id,useragent:navigator.userAgent,action:"_wnd_ajax_update_views"},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wnd.api_nonce)},success:function(response){1===response.status&&localStorage.setItem("wnd_views",JSON.stringify(wnd_views))}})}jQuery(document).ready(function($){$("body").off("click").on("click",".modal-background,.modal-close",function(){wnd_reset_modal()})}),jQuery(document).ready(function($){$("body").on("change","[type='file']",function(){if("ajax"==$(this).data("method")){var id=$(this).data("id"),form_data=new FormData,filename=$(this).val().split("\\").pop();filename=filename.substring(0,filename.lastIndexOf("."));for(var i=0;i<$(this).get(0).files.length;++i)form_data.append("wnd_file["+i+"]",$(this).prop("files")[i]);var meta_key=$(this).data("meta_key"),post_parent=$(this).data("post_parent"),_ajax_nonce=$(this).data("upload_nonce"),_meta_key_nonce=$(this).data("meta_key_nonce"),save_width=$(this).data("save_width"),save_height=$(this).data("save_height"),is_image=$(this).data("is_image"),thumbnail_width=$(this).data("thumbnail-width"),thumbnail_height=$(this).data("thumbnail-height");form_data.append("meta_key",meta_key),form_data.append("post_parent",post_parent),form_data.append("_ajax_nonce",_ajax_nonce),form_data.append("_meta_key_nonce",_meta_key_nonce),form_data.append("save_width",save_width),form_data.append("save_height",save_height),form_data.append("thumbnail_height",thumbnail_height),form_data.append("thumbnail_width",thumbnail_width),form_data.append("action","wnd_ajax_upload_file");var _this=$(this);$.ajax({url:wnd.api_url,dataType:"json",cache:!1,contentType:!1,processData:!1,data:form_data,type:"POST",beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wnd.api_nonce),wnd_ajax_msg("正在处理，请勿关闭页面！","is-warning","#"+id)},success:function(response){if(_this.val(""),0===response.status)return wnd_ajax_msg(response.msg,"is-danger","#"+id),!1;for(var i=0,n=response.length;i<n;i++)if(0!==response[i].status){if(wnd_ajax_msg("上传成功！","is-success","#"+id),"gallery"==meta_key){$("#"+id+" .gallery .default-message").remove();var new_img_element='<div class="column is-narrow attachment-'+response[i].data.id+'"><a><img class="thumbnail" src="'+response[i].data.thumbnail+'" data-url="'+response[i].data.url+'" width="'+thumbnail_width+'" width="'+thumbnail_height+'"></a><a class="delete" data-id="'+id+'" data-file_id="'+response[i].data.id+'"></a></div>';$("#"+id+" .gallery").prepend(new_img_element)}else 1==is_image?($("#"+id+" .thumbnail").prop("src",response[i].data.thumbnail),$("#"+id+" .delete").data("file_id",response[i].data.id)):($("#"+id+" .file-name").html('上传成功！<a href="'+response[i].data.url+'" target="_blank">查看文件</a>'),$("#"+id+" .delete").data("file_id",response[i].data.id));"attachment"==_this.parents("form").find("input[name='_post_post_type']").val()&&(_this.parents("form").find("input[name='_post_ID']").val(response[i].data.id),_this.parents("form").find("input[name='_post_post_title']").val()||_this.parents("form").find("input[name='_post_post_title']").val(filename),_this.parents("form").find("input[name='_post_post_name']").val()||_this.parents("form").find("input[name='_post_post_name']").val(response[i].data.post.post_name),_this.parents("form").find("input[name='_post_menu_order']").val()||_this.parents("form").find("input[name='_post_menu_order']").val(response[i].data.post.menu_order),_this.attr("disabled",!0),wnd_ajax_msg("上传成功，如需更改，请删除后再重新选择文件！","is-success","#"+id),wnd_ajax_submit(_this.parents("form").attr("id")))}else wnd_ajax_msg(response[i].msg,"is-danger","#"+id)},error:function(){wnd_ajax_msg("系统错误！","is-danger","#"+id)}})}}),$("body").on("click",".upload-field .delete",function(){if(!confirm("确定删除？"))return!1;var id=$(this).data("id"),file_id=$(this).data("file_id");if(!file_id)return wnd_ajax_msg("没有可删除的文件！","is-danger","#"+id),!1;var form_data=new FormData,meta_key=$("#"+id+" [type='file']").data("meta_key"),post_parent=$("#"+id+" [type='file']").data("post_parent"),_ajax_nonce=$("#"+id+" [type='file']").data("delete_nonce"),is_image=$("#"+id+" [type='file']").data("is_image"),thumbnail=$("#"+id+" [type='file']").data("thumbnail");form_data.append("meta_key",meta_key),form_data.append("post_parent",post_parent),form_data.append("file_id",file_id),form_data.append("_ajax_nonce",_ajax_nonce),form_data.append("action","wnd_ajax_delete_file"),$.ajax({url:wnd.api_url,dataType:"json",cache:!1,contentType:!1,processData:!1,data:form_data,type:"post",beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wnd.api_nonce),wnd_ajax_msg("删除中……","is-warning","#"+id)},success:function(response){if(0===response.status)return wnd_ajax_msg(response.msg,"is-danger","#"+id),!1;wnd_ajax_msg("已删除！","is-success","#"+id),$("#"+id+" [type='file']").attr("disabled",!1),$(".attachment-"+file_id).remove(),"gallery"==meta_key?""==$("#"+id+" .gallery").html()&&$("#"+id+" .gallery").html('<div class="column default-message"><p>已删除全部图片</p></div>'):1==is_image?($("#"+id+" .thumbnail").prop("src",thumbnail),$("#"+id+" .delete").data("file_id",0)):($("#"+id+" .file-name").text("文件已删除……"),$("#"+id+" .delete").data("file_id",0))},error:function(){wnd_ajax_msg("系统错误！","is-danger","#"+id)}})}),$("body").on("click",".send-code",function(){clearTimeout(send_countdown),wait=90;var _this=$(this),form_id=_this.parents("form").attr("id"),verify_type=$(this).data("verify-type"),send_type=$(this).data("send-type"),template=$(this).data("template"),nonce=$(this).data("nonce"),phone=$("#"+form_id+" input[name='phone']").val(),_user_user_email=$("#"+form_id+" input[name='_user_user_email']").val();if(""==_user_user_email||""==phone)return wnd_ajax_msg("不知道发送到给谁……","is-danger","#"+form_id),!1;$.ajax({type:"post",dataType:"json",url:wnd.api_url,data:{action:"wnd_ajax_send_code",email:_user_user_email,phone:phone,verify_type:verify_type,send_type:send_type,template:template,_ajax_nonce:nonce},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wnd.api_nonce),_this.addClass("is-loading")},success:function(response){if(response.status<=0)var style="is-danger";else{var style="is-success";_this.attr("disabled",!0),_this.text("已发送"),wnd_send_countdown()}wnd_ajax_msg(response.msg,style,"#"+form_id),_this.removeClass("is-loading")},error:function(){wnd_ajax_msg("发送失败！","is-danger","#"+form_id),_this.removeClass("is-loading")}})});var can_click_ajax_link=!0;$("body").on("click",".ajax-link",function(){var is_in_modal=!!$(this).parents(".modal.is-active").length;if(can_click_ajax_link)if(can_click_ajax_link=!1,setTimeout(function(){can_click_ajax_link=!0},1e3),1!=$(this).data("disabled")){var is_cancel=$(this).data("is-cancel"),action=is_cancel?$(this).data("cancel"):$(this).data("action"),nonce=is_cancel?$(this).data("cancel-nonce"):$(this).data("action-nonce"),_this=$(this);$.ajax({type:"POST",url:wnd.api_url,data:{action:action,param:$(this).data("param"),_ajax_nonce:nonce},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wnd.api_nonce)},success:function(response){switch(0!=response.status&&action==_this.data("action")?_this.data("cancel")?_this.data("is-cancel",1):_this.data("disabled",1):_this.data("is-cancel",0),response.status){case 1:_this.html(response.data);break;case 2:response.data&&_this.html(response.data),is_in_modal||wnd_alert_msg(response.msg,1);break;case 3:wnd_alert_msg("请稍后……"),$(window.location).attr("href",response.data.redirect_to);break;case 4:wnd_reset_modal(),window.location.reload(!0);break;default:_this.html(response.data),is_in_modal||wnd_alert_msg(response.msg,1)}},error:function(){wnd_alert_msg("系统错误！")}})}else wnd_alert_msg("请勿重复操作！",1)}),$("body").on("input","input,textarea",function(){$(this).removeClass("is-danger")}),$("body").on("change","form",function(){var submit_button=$(this).find("[type='submit']");submit_button.attr("disabled",!1),submit_button.text(submit_button.data("text"))}),$("body").on("click",".menu a",function(){$(this).parents(".menu").find("a").removeClass("is-active"),$(this).addClass("is-active")}),$("body").on("click",".tabs a",function(){$(this).parent("li").addClass("is-active"),$(this).parent("li").siblings().removeClass("is-active")}),$("body").on("click",".navbar-burger",function(){$(this).parents(".navbar").find(".navbar-menu").toggleClass("is-active"),$(this).toggleClass("is-active")}),$("body").on("click","[type='submit'].ajax-submit",function(){var form_id=$(this).parents("form").attr("id");form_id?wnd_ajax_submit(form_id):wnd_alert_msg("未找到指定表单",1)}),$("body").on("click",".pagination-link",function(){$(this).parents("nav").parent().get(0).scrollIntoView({behavior:"smooth"})}),$("body").on("click",".gallery img",function(){var images=$(this).parents(".gallery").find("img"),element;wnd_alert_modal('<img src="'+$(this).data("url")+'" />',!0)})});